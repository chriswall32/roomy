"use strict";!function(o){o.module("application",["ngRoute"]).constant("applicationSettings",{applicationTitle:"Geekwise Room Reserve App",getFirebaseRestUrl:function(o){return"https://confdeconflictor.firebaseio.com/"+o+".json"},getImagePath:function(o){return"www/assets/images/"+o}}).config(["$locationProvider","$routeProvider",function(o,t){o.html5Mode(!0),t.when("/room/:id",{template:"<gw-room></gw-room>"}).when("/welcome",{template:"<gw-login></gw-login>"}).when("/about",{template:"<gw-login></gw-login>"}).otherwise({template:"<gw-login></gw-login>"})}])}(window.angular),function(o){o.module("application").controller("exerciseOneController",["es",function(o){var t=this;this.exerciseService=o,this.title="Exercise 1, in the controller",this.clickAction=function(){console.log(t)},this.students=[{name:"John"},{name:"Josh"},{name:"Mack"}]}])}(window.angular),function(o){o.module("application").controller("exerciseTwoController",["es",function(o){var t=this;this.exerciseService=o,this.title="Exercise 2";this.buttonText="Button Text",this.possibleColors=[{name:"Brown",hex:"#a52"},{name:"Blue",hex:"#0000FF"},{name:"Gainsboro",hex:"#dcdcdc"}],this._getRandomColor=function(){return t.possibleColors[Math.floor(Math.random()*t.possibleColors.length)]},this._createObject=function(){var o={name:"Obj"+(t.objectArray.length+1),clickCount:0,color:t._getRandomColor().hex};return console.log(o),o},this.buttonMouseEnter=function(){this.buttonText="New Button Text"},this.buttonResetClick=function(){t.buttonText="Button Text"},this.objectArray=[],this.controllerInitObject=this._createObject(),this.addNewObject=function(){this.objectArray.push(this._createObject())},this.addClickCount=function(o){o.clickCount++,console.log(o.name,o.clickCount)},this.colorfilterChanged=function(){console.log(t.filter.color),t.filter.color||delete t.filter.color}}])}(window.angular),function(o){o.module("application").service("es",function(){function o(){this.loggedInUser={name:"userName",photo:"https://unsplash.com/?photo=ehNGoB6q5p4",userPassword:"password",date:Date.now},console.log(this.loggedInUser)}function t(){this.loggedInUser={},console.log(this.loggedInUser)}this.loggedInUser={},this.login=o,this.logout=t}).factory("es",function(){function o(){return console.log("Getting loggedInUser",e),e}function t(){console.log("We're here factory style"),e={name:"Ted",photo:"angularicon.jpg",loginTime:Date.now()}}function n(){e={}}return{getLoggedInUser:o,login:t,logout:n};var e})}(window.angular),function(o){o.module("application").factory("loginService",["$rootScope",function(o){function t(t){r=t,o.$apply()}function n(){return r}function e(){return firebase.auth().signInWithPopup(new firebase.auth.GithubAuthProvider)}function i(){return r=null,firebase.auth().signOut()}var r=null;return firebase.auth().onAuthStateChanged(t),{getLoggedInUser:n,login:e,logout:i}}])}(window.angular),function(o){o.module("application").factory("navigationService",function(){function o(){return e}function t(o){e||(e=[]),e.push(o)}function n(o){e.forEach(function(t,n){t.id===o.id&&e.splice(n,1)})}return{getNavigation:o,addNavigationItem:t,removeNavigationItem:n};var e})}(window.angular),function(o){o.module("application").factory("roomService",["$http","applicationSettings",function(o,t){function n(n){return o.get(t.getFirebaseRestUrl("rooms/"+n)).then(function(o){return o.data})}function e(){return o.get(t.getFirebaseRestUrl("rooms")).then(function(o){return o.data})}function i(){var n=t.getFirebaseRestUrl("rooms");return o.delete(n).then(function(){return o.put(n,{halo:{name:"Halo",picture:"halo.jpg"},sonic:{name:"Sonic",picture:"sonic.jpg"},zelda:{name:"Zelda",picture:"zelda.jpg"},starfox:{name:"Star Fox",picture:"starfox.jpg"},simcity:{name:"Sim City",picture:"simcity.jpg"}})}).then(e)}function r(e,i){return n(e).then(function(n){return o.post(t.getFirebaseRestUrl("rooms/"+e+"/reservations/"+a()),i)})}function a(o){var t=void 0;return t=o?new Date(o).toDateString():(new Date).toDateString(),t=t.replace(/ /g,"")}return{getRoomById:n,fetchRoomsFromDB:e,resetRoomsToDB:i,writeRoomReservation:r,getRoomDateKey:a}}])}(window.angular),function(o){o.module("application").component("gwLogin",{templateUrl:"www/app/components/login/login.htm",controller:"loginComponentController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("loginComponentController",["$scope","loginService",function(o,t){this.loginService=t,this.getLoggedInUser=t.getLoggedInUser,this.refresh=function(){console.log("Controller refresh called"),o.$apply()}}])}(window.angular),function(o){o.module("application").component("gwNavigation",{templateUrl:"www/app/components/navigation/navigation.htm",controller:"navigationComponentController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("navigationComponentController",["$location","navigationService","roomService",function(t,n,e){this.$onInit=function(){this.navigationService=n;var t={title:"Welcome",url:"/welcome"};n.addNavigationItem(t),e.fetchRoomsFromDB().then(function(t){o.forEach(t,function(o,t){var e={title:o.name,url:"/room/"+t};n.addNavigationItem(e)});var e={title:"About",url:"/about"};n.addNavigationItem(e)})},this.isItemActive=function(o){return o===t.path()}}])}(window.angular),function(o){o.module("application").component("gwRoom",{templateUrl:"www/app/components/room/room.htm",controller:"roomComponentController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("roomComponentController",["$routeParams","applicationSettings","roomService",function(o,t,n){this.$onInit=function(){this.initRoom()},this.onSubmitted=function(){console.log("Our form component just updated roomComponent through output binding"),this.initRoom()},this.initRoom=function(){var e=this;this.loading=!0,n.getRoomById(o.id).then(function(n){e.room=n,e.room.id=o.id,e.room.picture=t.getImagePath(e.room.picture),e.loading=!1})}}])}(window.angular),function(o){o.module("application").component("gwRoomReservationList",{templateUrl:"www/app/components/room/room-reservation-list/room-reservation-list.htm",controller:"roomReservationListComponentController",controllerAs:"ctrl",require:{parentController:"^gwRoom"}})}(window.angular),function(o){o.module("application").controller("roomReservationListComponentController",function(){})}(window.angular),function(o){o.module("application").component("gwRoomReservationForm",{templateUrl:"www/app/components/room/room-reservation-form/room-reservation-form.htm",controller:"roomReservationFormController",controllerAs:"ctrl",bindings:{room:"<",onSubmitted:"&"}})}(window.angular),function(o){o.module("application").controller("roomReservationFormController",["roomService",function(o){this.$onInit=function(){this.startTime=new Date,this.startTime.setHours(12,0,0,0),this.endTime=new Date,this.endTime.setHours(12,0,0,0),this.reserveReasons=["Birthday","Conference","Interview","Scrum Meeting","Client Meeting","Honeymoon"],this.roomSubmission=function(){if(this.getMinTime()>=this.endTime)return this.myForm.endTime.$setValidity("min",!1);var t={};return t.email=this.email1,t.startTime=this.startTime,t.endTime=this.endTime,t.specialInstructions=this.specialInstructions,t.reserveReason=this.reserveReason,o.writeRoomReservation(this.room.id,t).then(this.onSubmitted()).catch(function(o){return alert(o.data.error)})},this.getMinTime=function(){var o=new Date(this.startTime);return o.setHours(o.getHours()+.9),o}}}])}(window.angular),function(o){o.module("application").component("gwRoomStatusHeader",{templateUrl:"www/app/components/room/room-status-header/room-status-header.htm",controller:"roomStatusHeaderComponentController",controllerAs:"ctrl",bindings:{room:"@"}})}(window.angular),function(o){o.module("application").controller("roomStatusHeaderComponentController",function(){})}(window.angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5taW4uanMiLCJpbmRleC5qcyIsImNvbnRyb2xsZXJzL2V4ZXJjaXNlT25lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2V4ZXJjaXNlVHdvQ29udHJvbGxlci5qcyIsInNlcnZpY2VzL2V4ZXJjaXNlVHdvU2VydmljZXMuanMiLCJzZXJ2aWNlcy9sb2dpbi5zZXJ2aWNlLmpzIiwic2VydmljZXMvbmF2aWdhdGlvbi5zZXJ2aWNlLmpzIiwic2VydmljZXMvcm9vbS5zZXJ2aWNlLmpzIiwiY29tcG9uZW50cy9sb2dpbi9sb2dpbi5jb21wb25lbnQuanMiLCJjb21wb25lbnRzL2xvZ2luL2xvZ2luLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL25hdmlnYXRpb24vbmF2aWdhdGlvbi5jb21wb25lbnQuanMiLCJjb21wb25lbnRzL25hdmlnYXRpb24vbmF2aWdhdGlvbi5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9yb29tL3Jvb20uY29tcG9uZW50LmpzIiwiY29tcG9uZW50cy9yb29tL3Jvb20uY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvcm9vbS9yb29tLXJlc2VydmF0aW9uLWxpc3Qvcm9vbS1yZXNlcnZhdGlvbi1saXN0LmNvbXBvbmVudC5qcyIsImNvbXBvbmVudHMvcm9vbS9yb29tLXJlc2VydmF0aW9uLWxpc3Qvcm9vbS1yZXNlcnZhdGlvbi1saXN0LmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL3Jvb20vcm9vbS1yZXNlcnZhdGlvbi1mb3JtL3Jvb20tcmVzZXJ2YXRpb24tZm9ybS5jb21wb25lbnQuanMiLCJjb21wb25lbnRzL3Jvb20vcm9vbS1yZXNlcnZhdGlvbi1mb3JtL3Jvb20tcmVzZXJ2YXRpb24tZm9ybS5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9yb29tL3Jvb20tc3RhdHVzLWhlYWRlci9yb29tLXN0YXR1cy1oZWFkZXIuY29tcG9uZW50LmpzIiwiY29tcG9uZW50cy9yb29tL3Jvb20tc3RhdHVzLWhlYWRlci9yb29tLXN0YXR1cy1oZWFkZXIuY29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJhcHBsaWNhdGlvblRpdGxlIiwiZ2V0RmlyZWJhc2VSZXN0VXJsIiwic3VmZml4IiwiZ2V0SW1hZ2VQYXRoIiwiZmlsZSIsImNvbmZpZyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHJvdXRlUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJ3aGVuIiwidGVtcGxhdGUiLCJvdGhlcndpc2UiLCJ3aW5kb3ciLCJjb250cm9sbGVyIiwiZXMiLCJfdGhpcyIsInRoaXMiLCJleGVyY2lzZVNlcnZpY2UiLCJ0aXRsZSIsImNsaWNrQWN0aW9uIiwiY29uc29sZSIsImxvZyIsInN0dWRlbnRzIiwibmFtZSIsImJ1dHRvblRleHQiLCJwb3NzaWJsZUNvbG9ycyIsImhleCIsIl9nZXRSYW5kb21Db2xvciIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsIl9jcmVhdGVPYmplY3QiLCJyZXR1cm5PYmplY3QiLCJvYmplY3RBcnJheSIsImNsaWNrQ291bnQiLCJjb2xvciIsImJ1dHRvbk1vdXNlRW50ZXIiLCJidXR0b25SZXNldENsaWNrIiwiY29udHJvbGxlckluaXRPYmplY3QiLCJhZGROZXdPYmplY3QiLCJwdXNoIiwiYWRkQ2xpY2tDb3VudCIsIm9iaiIsImNvbG9yZmlsdGVyQ2hhbmdlZCIsImZpbHRlciIsInNlcnZpY2UiLCJsb2dpbiIsImxvZ2dlZEluVXNlciIsInBob3RvIiwidXNlclBhc3N3b3JkIiwiZGF0ZSIsIkRhdGUiLCJub3ciLCJsb2dvdXQiLCJmYWN0b3J5IiwiZ2V0TG9nZ2VkSW5Vc2VyIiwibG9naW5UaW1lIiwiJHJvb3RTY29wZSIsInVwZGF0ZUxvZ2luU3RhdHVzIiwiYXV0aGVudGljYXRlZFVzZXIiLCIkYXBwbHkiLCJmaXJlYmFzZSIsImF1dGgiLCJzaWduSW5XaXRoUG9wdXAiLCJHaXRodWJBdXRoUHJvdmlkZXIiLCJzaWduT3V0Iiwib25BdXRoU3RhdGVDaGFuZ2VkIiwiZ2V0TmF2aWdhdGlvbiIsIm5hdmlnYXRpb25JdGVtcyIsImFkZE5hdmlnYXRpb25JdGVtIiwiaXRlbSIsInJlbW92ZU5hdmlnYXRpb25JdGVtIiwiZm9yRWFjaCIsIml0ZW1Jbk5hdmlnYXRpb24iLCJpbmRleCIsImlkIiwic3BsaWNlIiwiJGh0dHAiLCJhcHBsaWNhdGlvblNldHRpbmdzIiwiZ2V0Um9vbUJ5SWQiLCJnZXQiLCJ0aGVuIiwicmVzcG9uc2UiLCJkYXRhIiwiZmV0Y2hSb29tc0Zyb21EQiIsInJlc2V0Um9vbXNUb0RCIiwidXJsIiwiZGVsZXRlIiwicHV0IiwiaGFsbyIsInBpY3R1cmUiLCJzb25pYyIsInplbGRhIiwic3RhcmZveCIsInNpbWNpdHkiLCJ3cml0ZVJvb21SZXNlcnZhdGlvbiIsInJlc2VydmF0aW9uIiwicm9vbSIsInBvc3QiLCJnZXRSb29tRGF0ZUtleSIsImRhdGVLZXkiLCJ0b0RhdGVTdHJpbmciLCJyZXBsYWNlIiwiY29tcG9uZW50IiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyQXMiLCIkc2NvcGUiLCJsb2dpblNlcnZpY2UiLCJyZWZyZXNoIiwiJGxvY2F0aW9uIiwibmF2aWdhdGlvblNlcnZpY2UiLCJyb29tU2VydmljZSIsIiRvbkluaXQiLCJ3ZWxjb21lSXRlbSIsInJvb21zIiwib2JqZWN0VmFsdWUiLCJvYmplY3RLZXkiLCJpdGVtVG9BZGQiLCJhYm91dEl0ZW0iLCJpc0l0ZW1BY3RpdmUiLCJwYXRoIiwiJHJvdXRlUGFyYW1zIiwiaW5pdFJvb20iLCJvblN1Ym1pdHRlZCIsImxvYWRpbmciLCJyb29tUmVzdWx0IiwicmVxdWlyZSIsInBhcmVudENvbnRyb2xsZXIiLCJiaW5kaW5ncyIsInN0YXJ0VGltZSIsInNldEhvdXJzIiwiZW5kVGltZSIsInJlc2VydmVSZWFzb25zIiwicm9vbVN1Ym1pc3Npb24iLCJnZXRNaW5UaW1lIiwibXlGb3JtIiwiJHNldFZhbGlkaXR5IiwicmVzZXJ2YXRpb25TdWJtaXNzaW9uIiwiZW1haWwiLCJlbWFpbDEiLCJzcGVjaWFsSW5zdHJ1Y3Rpb25zIiwicmVzZXJ2ZVJlYXNvbiIsImNhdGNoIiwiYWxlcnQiLCJlcnJvciIsImdldEhvdXJzIl0sIm1hcHBpbmdzIjoiQUFBQSxjQ0FDLFNBQVNBLEdBQ1JBLEVBQ0dDLE9BQU8sZUFBZ0IsWUFFdkJDLFNBQVMsdUJBQ1JDLGlCQUFrQiw0QkFFbEJDLG1CQUFvQixTQUFTQyxHQUkzQixNQUhlLDJDQUdDQSxFQUZKLFNBS2RDLGFBQWMsU0FBU0MsR0FDckIsTUFBQSxxQkFBNEJBLEtBSy9CQyxRQUFRLG9CQUFxQixpQkFBa0IsU0FBU0MsRUFBbUJDLEdBQzFFRCxFQUFrQkUsV0FBVSxHQUk1QkQsRUFDREUsS0FBSyxhQUNMQyxTQUFXLHdCQUVYRCxLQUFLLFlBQ0xDLFNBQVcsMEJBRVhELEtBQUssVUFDTEMsU0FBVywwQkFFWEMsV0FDQUQsU0FBVyw4QkFLZEUsT0FBT2YsU0N6Q1IsU0FBVUEsR0FDVEEsRUFDR0MsT0FBTyxlQUNQZSxXQUFXLHlCQUFBLEtBQXlCLFNBQVNDLEdBQUksR0FBQUMsR0FBQUMsSUFFaERBLE1BQUtDLGdCQUFrQkgsRUFFdkJFLEtBQUtFLE1BQVEsZ0NBRWhCRixLQUFLRyxZQUFjLFdBQ2xCQyxRQUFRQyxJQUFSTixJQUdEQyxLQUFLTSxXQUNGQyxLQUFNLFNBQ05BLEtBQU0sU0FDTkEsS0FBTSxhQUtWWCxPQUFPZixTQ3JCUixTQUFVQSxHQUNUQSxFQUNHQyxPQUFPLGVBQ1BlLFdBQVcseUJBQUEsS0FBeUIsU0FBU0MsR0FBSSxHQUFBQyxHQUFBQyxJQUVoREEsTUFBS0MsZ0JBQWtCSCxFQUV2QkUsS0FBS0UsTUFBUSxZQUliRixNQUFLUSxXQURzQixjQUczQlIsS0FBS1MsaUJBQ0ZGLEtBQVEsUUFDVEcsSUFBUSxTQUVOSCxLQUFPLE9BQ1BHLElBQU0sWUFHTkgsS0FBTyxZQUNQRyxJQUFNLFlBSVZWLEtBQUtXLGdCQUFrQixXQUVyQixNQURvQlosR0FBS1UsZUFBZUcsS0FBS0MsTUFBTUQsS0FBS0UsU0FBV2YsRUFBS1Us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SCxPQUFPSixRQUFRSyxhQUFhLE9BQU8sRUFFdEYsSUFBTUMsS0FPTixPQU5BQSxHQUFzQkMsTUFBUTNILEtBQUs0SCxPQUNuQ0YsRUFBc0JSLFVBQVlsSCxLQUFLa0gsVUFDdkNRLEVBQXNCTixRQUFVcEgsS0FBS29ILFFBQ3JDTSxFQUFzQkcsb0JBQXNCN0gsS0FBSzZILG9CQUNqREgsRUFBc0JJLGNBQWdCOUgsS0FBSzhILGNBRXBDOUIsRUFBWWhCLHFCQUFxQmhGLEtBQUtrRixLQUFLdEIsR0FBSThELEdBQ3BEeEQsS0FBS2xFLEtBQUs0RyxlQUNWbUIsTUFBTSxTQUFBNUQsR0FBQSxNQUFZNkQsT0FBTTdELEVBQVNDLEtBQUs2RCxVQUd6Q2pJLEtBQUt1SCxXQUFhLFdBQ2pCLEdBQUlwRixHQUFPLEdBQUlDLE1BQUtwQyxLQUFLa0gsVUFHekIsT0FGQS9FLEdBQUtnRixTQUFTaEYsRUFBSytGLFdBQWEsSUFFekIvRixRQUlWdkMsT0FBT2YsU0M3Q1IsU0FBVUEsR0FDVEEsRUFDR0MsT0FBTyxlQUNQMEcsVUFBVSxzQkFDVEMsWUFBZ0Isb0VBQ2hCNUYsV0FBZ0Isc0NBQ2hCNkYsYUFBZ0IsT0FDaEJ1QixVQUNFL0IsS0FBTyxRQUladEYsT0FBT2YsU0NaVCxTQUFVQSxHQUNQQSxFQUNLQyxPQUFPLGVBRVBlLFdBQVcsc0NBQXVDLGVBR3pERCxPQUFPZiIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIsIFtcIm5nUm91dGVcIl0pLmNvbnN0YW50KFwiYXBwbGljYXRpb25TZXR0aW5nc1wiLCB7XG4gICAgYXBwbGljYXRpb25UaXRsZTogXCJHZWVrd2lzZSBSb29tIFJlc2VydmUgQXBwXCIsXG5cbiAgICBnZXRGaXJlYmFzZVJlc3RVcmw6IGZ1bmN0aW9uIGdldEZpcmViYXNlUmVzdFVybChzdWZmaXgpIHtcbiAgICAgIHZhciBwcmVmaXggPSBcImh0dHBzOi8vY29uZmRlY29uZmxpY3Rvci5maXJlYmFzZWlvLmNvbS9cIjtcbiAgICAgIHZhciBleHQgPSBcIi5qc29uXCI7XG5cbiAgICAgIHJldHVybiBwcmVmaXggKyBzdWZmaXggKyBleHQ7XG4gICAgfSxcblxuICAgIGdldEltYWdlUGF0aDogZnVuY3Rpb24gZ2V0SW1hZ2VQYXRoKGZpbGUpIHtcbiAgICAgIHJldHVybiBcInd3dy9hc3NldHMvaW1hZ2VzL1wiICsgZmlsZTtcbiAgICB9XG4gIH0pLmNvbmZpZyhbXCIkbG9jYXRpb25Qcm92aWRlclwiLCBcIiRyb3V0ZVByb3ZpZGVyXCIsIGZ1bmN0aW9uICgkbG9jYXRpb25Qcm92aWRlciwgJHJvdXRlUHJvdmlkZXIpIHtcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICAvLyBjb25zb2xlLmxvZyhcIkZpbmQgTWVcIik7XG5cbiAgICAkcm91dGVQcm92aWRlci53aGVuKFwiL3Jvb20vOmlkXCIsIHtcbiAgICAgIHRlbXBsYXRlOiBcIjxndy1yb29tPjwvZ3ctcm9vbT5cIlxuICAgIH0pLndoZW4oXCIvd2VsY29tZVwiLCB7XG4gICAgICB0ZW1wbGF0ZTogXCI8Z3ctbG9naW4+PC9ndy1sb2dpbj5cIlxuICAgIH0pLndoZW4oXCIvYWJvdXRcIiwge1xuICAgICAgdGVtcGxhdGU6IFwiPGd3LWxvZ2luPjwvZ3ctbG9naW4+XCJcbiAgICB9KS5vdGhlcndpc2Uoe1xuICAgICAgdGVtcGxhdGU6IFwiPGd3LWxvZ2luPjwvZ3ctbG9naW4+XCJcbiAgICB9KTtcbiAgfV0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuXHRhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJleGVyY2lzZU9uZUNvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKGVzKSB7XG5cdFx0dmFyIF90aGlzID0gdGhpcztcblxuXHRcdC8vaW5qZWN0XG5cblx0XHR0aGlzLmV4ZXJjaXNlU2VydmljZSA9IGVzOyAvL2V4cG9zZVxuXG5cdFx0dGhpcy50aXRsZSA9IFwiRXhlcmNpc2UgMSwgaW4gdGhlIGNvbnRyb2xsZXJcIjtcblxuXHRcdHRoaXMuY2xpY2tBY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhfdGhpcyk7XG5cdFx0fTtcblxuXHRcdHRoaXMuc3R1ZGVudHMgPSBbeyBuYW1lOiBcIkpvaG5cIiB9LCB7IG5hbWU6IFwiSm9zaFwiIH0sIHsgbmFtZTogXCJNYWNrXCIgfV07XG5cdH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJleGVyY2lzZVR3b0NvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKGVzKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIC8vaW5qZWN0XG5cbiAgICB0aGlzLmV4ZXJjaXNlU2VydmljZSA9IGVzOyAvL2V4cG9zZVxuXG4gICAgdGhpcy50aXRsZSA9IFwiRXhlcmNpc2UgMlwiO1xuXG4gICAgdmFyIG9yaWdpbmFsQnV0dG9uVGV4dCA9IFwiQnV0dG9uIFRleHRcIjtcbiAgICB0aGlzLmJ1dHRvblRleHQgPSBvcmlnaW5hbEJ1dHRvblRleHQ7XG5cbiAgICB0aGlzLnBvc3NpYmxlQ29sb3JzID0gW3sgbmFtZTogXCJCcm93blwiLFxuICAgICAgaGV4OiBcIiNhNTJcIiB9LCB7XG4gICAgICBuYW1lOiBcIkJsdWVcIixcbiAgICAgIGhleDogXCIjMDAwMEZGXCJcbiAgICB9LCB7XG4gICAgICBuYW1lOiBcIkdhaW5zYm9yb1wiLFxuICAgICAgaGV4OiBcIiNkY2RjZGNcIlxuICAgIH1dO1xuXG4gICAgdGhpcy5fZ2V0UmFuZG9tQ29sb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcmFuZG9tQ29sb3IgPSBfdGhpcy5wb3NzaWJsZUNvbG9yc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBfdGhpcy5wb3NzaWJsZUNvbG9ycy5sZW5ndGgpXTtcbiAgICAgIHJldHVybiByYW5kb21Db2xvcjtcbiAgICB9O1xuXG4gICAgdGhpcy5fY3JlYXRlT2JqZWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJldHVybk9iamVjdCA9IHtcbiAgICAgICAgbmFtZTogXCJPYmpcIiArIChfdGhpcy5vYmplY3RBcnJheS5sZW5ndGggKyAxKSxcbiAgICAgICAgY2xpY2tDb3VudDogMCxcbiAgICAgICAgY29sb3I6IF90aGlzLl9nZXRSYW5kb21Db2xvcigpLmhleFxuICAgICAgfTtcbiAgICAgIGNvbnNvbGUubG9nKHJldHVybk9iamVjdCk7XG4gICAgICByZXR1cm4gcmV0dXJuT2JqZWN0O1xuICAgIH07XG5cbiAgICB0aGlzLmJ1dHRvbk1vdXNlRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmJ1dHRvblRleHQgPSBcIk5ldyBCdXR0b24gVGV4dFwiO1xuICAgIH07XG5cbiAgICB0aGlzLmJ1dHRvblJlc2V0Q2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBfdGhpcy5idXR0b25UZXh0ID0gb3JpZ2luYWxCdXR0b25UZXh0O1xuICAgIH07XG5cbiAgICB0aGlzLm9iamVjdEFycmF5ID0gW107XG5cbiAgICB0aGlzLmNvbnRyb2xsZXJJbml0T2JqZWN0ID0gdGhpcy5fY3JlYXRlT2JqZWN0KCk7XG5cbiAgICAvL3RoaXMuY29udHJvbGxlckluaXRPYmplY3QuY2xpY2tDb3VudCA9IDU7XG5cbiAgICB0aGlzLmFkZE5ld09iamVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMub2JqZWN0QXJyYXkucHVzaCh0aGlzLl9jcmVhdGVPYmplY3QoKSk7XG4gICAgfTtcblxuICAgIHRoaXMuYWRkQ2xpY2tDb3VudCA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIG9iai5jbGlja0NvdW50Kys7XG4gICAgICBjb25zb2xlLmxvZyhvYmoubmFtZSwgb2JqLmNsaWNrQ291bnQpO1xuICAgIH07XG5cbiAgICB0aGlzLmNvbG9yZmlsdGVyQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKF90aGlzLmZpbHRlci5jb2xvcik7XG4gICAgICBpZiAoIV90aGlzLmZpbHRlci5jb2xvcikgZGVsZXRlIF90aGlzLmZpbHRlci5jb2xvcjtcbiAgICB9O1xuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5zZXJ2aWNlKFwiZXNcIiwgZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubG9nZ2VkSW5Vc2VyID0ge307XG4gICAgdGhpcy5sb2dpbiA9IGxvZ2luO1xuICAgIHRoaXMubG9nb3V0ID0gbG9nb3V0O1xuXG4gICAgLy9pbXBsZW1lbnRhdGlvblxuICAgIGZ1bmN0aW9uIHByaW50Q29uc29sZSgpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiT3VyIHZlcnkgZmlyc3QgaW5qZWN0YWJsZVwiKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gbG9naW4oKSB7XG4gICAgICB0aGlzLmxvZ2dlZEluVXNlciA9IHtcbiAgICAgICAgbmFtZTogXCJ1c2VyTmFtZVwiLFxuICAgICAgICBwaG90bzogJ2h0dHBzOi8vdW5zcGxhc2guY29tLz9waG90bz1laE5Hb0I2cTVwNCcsXG4gICAgICAgIHVzZXJQYXNzd29yZDogXCJwYXNzd29yZFwiLFxuICAgICAgICBkYXRlOiBEYXRlLm5vd1xuICAgICAgfTtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMubG9nZ2VkSW5Vc2VyKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gbG9nb3V0KCkge1xuICAgICAgdGhpcy5sb2dnZWRJblVzZXIgPSB7fTtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMubG9nZ2VkSW5Vc2VyKTtcbiAgICB9O1xuICB9KS5mYWN0b3J5KFwiZXNcIiwgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICBnZXRMb2dnZWRJblVzZXI6IGdldExvZ2dlZEluVXNlcixcbiAgICAgIGxvZ2luOiBsb2dpbixcbiAgICAgIGxvZ291dDogbG9nb3V0XG4gICAgfTtcblxuICAgIHZhciBsb2dnZWRJblVzZXIgPSB7IHRlc3Q6IFwidGVzdFwiIH07XG5cbiAgICBmdW5jdGlvbiBnZXRMb2dnZWRJblVzZXIoKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkdldHRpbmcgbG9nZ2VkSW5Vc2VyXCIsIGxvZ2dlZEluVXNlcik7XG4gICAgICByZXR1cm4gbG9nZ2VkSW5Vc2VyO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvZ2luKCkge1xuICAgICAgY29uc29sZS5sb2coXCJXZSdyZSBoZXJlIGZhY3Rvcnkgc3R5bGVcIik7XG4gICAgICBkZWJ1Z2dlcjtcblxuICAgICAgbG9nZ2VkSW5Vc2VyID0ge1xuICAgICAgICBuYW1lOiBcIlRlZFwiLFxuICAgICAgICBwaG90bzogXCJhbmd1bGFyaWNvbi5qcGdcIixcbiAgICAgICAgbG9naW5UaW1lOiBEYXRlLm5vdygpXG4gICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgICAgIGxvZ2dlZEluVXNlciA9IHt9O1xuICAgIH1cbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuZmFjdG9yeShcImxvZ2luU2VydmljZVwiLCBmdW5jdGlvbiAoJHJvb3RTY29wZSkge1xuICAgIHZhciBsb2dnZWRJblVzZXIgPSBudWxsO1xuICAgIHZhciBub3RpZnlDb250cm9sbGVyQ2FsbGJhY2sgPSBudWxsO1xuXG4gICAgLy9hY3RpdmVseSBsaXN0ZW5zIEZpcmViYXNlIGF1dGhlbnRpY2F0aW9uIGFuZCBmaXJlcyBjYWxsYmFja1xuICAgIGZpcmViYXNlLmF1dGgoKS5vbkF1dGhTdGF0ZUNoYW5nZWQodXBkYXRlTG9naW5TdGF0dXMpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGdldExvZ2dlZEluVXNlcjogZ2V0TG9nZ2VkSW5Vc2VyLFxuICAgICAgbG9naW46IGxvZ2luLFxuICAgICAgbG9nb3V0OiBsb2dvdXRcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gdXBkYXRlTG9naW5TdGF0dXMoYXV0aGVudGljYXRlZFVzZXIpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGF1dGhlbnRpY2F0ZWRVc2VyKTtcblxuICAgICAgbG9nZ2VkSW5Vc2VyID0gYXV0aGVudGljYXRlZFVzZXI7XG4gICAgICAkcm9vdFNjb3BlLiRhcHBseSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldExvZ2dlZEluVXNlcigpIHtcbiAgICAgIHJldHVybiBsb2dnZWRJblVzZXI7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGxvZ2luKCkge1xuXG4gICAgICByZXR1cm4gZmlyZWJhc2UuYXV0aCgpLnNpZ25JbldpdGhQb3B1cChuZXcgZmlyZWJhc2UuYXV0aC5HaXRodWJBdXRoUHJvdmlkZXIoKSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9nb3V0KCkge1xuICAgICAgbG9nZ2VkSW5Vc2VyID0gbnVsbDtcbiAgICAgIHJldHVybiBmaXJlYmFzZS5hdXRoKCkuc2lnbk91dCgpO1xuICAgIH1cbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5mYWN0b3J5KFwibmF2aWdhdGlvblNlcnZpY2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0TmF2aWdhdGlvbjogZ2V0TmF2aWdhdGlvbixcbiAgICAgICAgICAgIGFkZE5hdmlnYXRpb25JdGVtOiBhZGROYXZpZ2F0aW9uSXRlbSxcbiAgICAgICAgICAgIHJlbW92ZU5hdmlnYXRpb25JdGVtOiByZW1vdmVOYXZpZ2F0aW9uSXRlbVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBuYXZpZ2F0aW9uSXRlbXMgPSBbXTtcblxuICAgICAgICBmdW5jdGlvbiBnZXROYXZpZ2F0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRpb25JdGVtcztcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGFkZE5hdmlnYXRpb25JdGVtKGl0ZW0pIHtcbiAgICAgICAgICAgIGlmICghbmF2aWdhdGlvbkl0ZW1zKSBuYXZpZ2F0aW9uSXRlbXMgPSBbXTtcbiAgICAgICAgICAgIG5hdmlnYXRpb25JdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlTmF2aWdhdGlvbkl0ZW0oaXRlbSkge1xuICAgICAgICAgICAgbmF2aWdhdGlvbkl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW1Jbk5hdmlnYXRpb24sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1Jbk5hdmlnYXRpb24uaWQgPT09IGl0ZW0uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbkl0ZW1zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcblx0YW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5mYWN0b3J5KFwicm9vbVNlcnZpY2VcIiwgZnVuY3Rpb24gKCRodHRwLCBhcHBsaWNhdGlvblNldHRpbmdzKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGdldFJvb21CeUlkOiBnZXRSb29tQnlJZCxcblx0XHRcdGZldGNoUm9vbXNGcm9tREI6IGZldGNoUm9vbXNGcm9tREIsXG5cdFx0XHRyZXNldFJvb21zVG9EQjogcmVzZXRSb29tc1RvREIsXG5cdFx0XHR3cml0ZVJvb21SZXNlcnZhdGlvbjogd3JpdGVSb29tUmVzZXJ2YXRpb24sXG5cdFx0XHRnZXRSb29tRGF0ZUtleTogZ2V0Um9vbURhdGVLZXlcblx0XHR9O1xuXG5cdFx0ZnVuY3Rpb24gZ2V0Um9vbUJ5SWQoaWQpIHtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoYXBwbGljYXRpb25TZXR0aW5ncy5nZXRGaXJlYmFzZVJlc3RVcmwoXCJyb29tcy9cIiArIGlkKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcblx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlLmRhdGE7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBmZXRjaFJvb21zRnJvbURCKCkge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldChhcHBsaWNhdGlvblNldHRpbmdzLmdldEZpcmViYXNlUmVzdFVybChcInJvb21zXCIpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuZGF0YTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHJlc2V0Um9vbXNUb0RCKCkge1xuXHRcdFx0dmFyIHVybCA9IGFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0RmlyZWJhc2VSZXN0VXJsKFwicm9vbXNcIik7XG5cblx0XHRcdHJldHVybiAkaHR0cC5kZWxldGUodXJsKS50aGVuKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0cmV0dXJuICRodHRwLnB1dCh1cmwsIHtcblx0XHRcdFx0XHRoYWxvOiB7XG5cdFx0XHRcdFx0XHRuYW1lOiBcIkhhbG9cIixcblx0XHRcdFx0XHRcdHBpY3R1cmU6ICdoYWxvLmpwZydcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHNvbmljOiB7XG5cdFx0XHRcdFx0XHRuYW1lOiBcIlNvbmljXCIsXG5cdFx0XHRcdFx0XHRwaWN0dXJlOiAnc29uaWMuanBnJ1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0emVsZGE6IHtcblx0XHRcdFx0XHRcdG5hbWU6IFwiWmVsZGFcIixcblx0XHRcdFx0XHRcdHBpY3R1cmU6ICd6ZWxkYS5qcGcnXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRzdGFyZm94OiB7XG5cdFx0XHRcdFx0XHRuYW1lOiBcIlN0YXIgRm94XCIsXG5cdFx0XHRcdFx0XHRwaWN0dXJlOiAnc3RhcmZveC5qcGcnXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRzaW1jaXR5OiB7XG5cdFx0XHRcdFx0XHRuYW1lOiBcIlNpbSBDaXR5XCIsXG5cdFx0XHRcdFx0XHRwaWN0dXJlOiAnc2ltY2l0eS5qcGcnXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0pLnRoZW4oZmV0Y2hSb29tc0Zyb21EQik7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gd3JpdGVSb29tUmVzZXJ2YXRpb24oaWQsIHJlc2VydmF0aW9uKSB7XG5cdFx0XHRyZXR1cm4gZ2V0Um9vbUJ5SWQoaWQpLnRoZW4oZnVuY3Rpb24gKHJvb20pIHtcblx0XHRcdFx0Ly8gd2UgZ2V0IHJvb20gc28gc29tZSB2YWxpZGF0aW9uIGNvdWxkIGJlIHBlcmZvcm1lZCBoZXJlIGJlZm9yZSB3ZSBwb3N0LCB0aG91Z2ggbm90ZSB0aGlzIGRvZXNuJ3Rcblx0XHRcdFx0Ly8gZWxpbWluYXRlIHJhY2UgY29uZGl0aW9uc1xuXG5cdFx0XHRcdC8vIGN1cnJlbnRseSwgdGhpcyBqdXN0IHBvc3RzIHRvIHRoZSBjdXJyZW50IGRhdGUgYmVjYXVzZSBub3RoaW5nIGlzIHBhc3NlZCBpbiBnZXRSb29tRGF0ZUtleVxuXHRcdFx0XHRyZXR1cm4gJGh0dHAucG9zdChhcHBsaWNhdGlvblNldHRpbmdzLmdldEZpcmViYXNlUmVzdFVybChcInJvb21zL1wiICsgaWQgKyBcIi9yZXNlcnZhdGlvbnMvXCIgKyBnZXRSb29tRGF0ZUtleSgpKSwgcmVzZXJ2YXRpb24pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0Um9vbURhdGVLZXkoZGF0ZSkge1xuXHRcdFx0dmFyIGRhdGVLZXkgPSB2b2lkIDA7XG5cblx0XHRcdGRhdGVLZXkgPSBkYXRlID8gbmV3IERhdGUoZGF0ZSkudG9EYXRlU3RyaW5nKCkgOiBuZXcgRGF0ZSgpLnRvRGF0ZVN0cmluZygpO1xuXHRcdFx0ZGF0ZUtleSA9IGRhdGVLZXkucmVwbGFjZSgvIC9nLCBcIlwiKTtcblxuXHRcdFx0cmV0dXJuIGRhdGVLZXk7XG5cdFx0fVxuXHR9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cInVzZSBzdHJpY3RcIjtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb21wb25lbnQoXCJnd0xvZ2luXCIsIHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ3d3cvYXBwL2NvbXBvbmVudHMvbG9naW4vbG9naW4uaHRtXCIsXG4gICAgY29udHJvbGxlcjogXCJsb2dpbkNvbXBvbmVudENvbnRyb2xsZXJcIixcbiAgICBjb250cm9sbGVyQXM6IFwiY3RybFwiXG4gIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJsb2dpbkNvbXBvbmVudENvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCRzY29wZSwgbG9naW5TZXJ2aWNlKSB7XG4gICAgdGhpcy5sb2dpblNlcnZpY2UgPSBsb2dpblNlcnZpY2U7XG5cbiAgICB0aGlzLmdldExvZ2dlZEluVXNlciA9IGxvZ2luU2VydmljZS5nZXRMb2dnZWRJblVzZXI7XG5cbiAgICB0aGlzLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkNvbnRyb2xsZXIgcmVmcmVzaCBjYWxsZWRcIik7XG4gICAgICAkc2NvcGUuJGFwcGx5KCk7XG4gICAgfTtcbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29tcG9uZW50KFwiZ3dOYXZpZ2F0aW9uXCIsIHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ3d3cvYXBwL2NvbXBvbmVudHMvbmF2aWdhdGlvbi9uYXZpZ2F0aW9uLmh0bVwiLFxuICAgIGNvbnRyb2xsZXI6IFwibmF2aWdhdGlvbkNvbXBvbmVudENvbnRyb2xsZXJcIixcbiAgICBjb250cm9sbGVyQXM6IFwiY3RybFwiXG4gIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJuYXZpZ2F0aW9uQ29tcG9uZW50Q29udHJvbGxlclwiLCBmdW5jdGlvbiAoJGxvY2F0aW9uLCBuYXZpZ2F0aW9uU2VydmljZSwgcm9vbVNlcnZpY2UpIHtcbiAgICB0aGlzLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlID0gbmF2aWdhdGlvblNlcnZpY2U7XG5cbiAgICAgIHZhciB3ZWxjb21lSXRlbSA9IHtcbiAgICAgICAgdGl0bGU6IFwiV2VsY29tZVwiLFxuICAgICAgICB1cmw6IFwiL3dlbGNvbWVcIlxuICAgICAgfTtcblxuICAgICAgbmF2aWdhdGlvblNlcnZpY2UuYWRkTmF2aWdhdGlvbkl0ZW0od2VsY29tZUl0ZW0pO1xuXG4gICAgICAvL2FkZCByb29tc1xuICAgICAgcm9vbVNlcnZpY2UuZmV0Y2hSb29tc0Zyb21EQigpLnRoZW4oZnVuY3Rpb24gKHJvb21zKSB7XG5cbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJvb21zLCBmdW5jdGlvbiAob2JqZWN0VmFsdWUsIG9iamVjdEtleSkge1xuICAgICAgICAgIHZhciBpdGVtVG9BZGQgPSB7XG4gICAgICAgICAgICB0aXRsZTogb2JqZWN0VmFsdWUubmFtZSxcbiAgICAgICAgICAgIHVybDogXCIvcm9vbS9cIiArIG9iamVjdEtleVxuICAgICAgICAgIH07XG4gICAgICAgICAgbmF2aWdhdGlvblNlcnZpY2UuYWRkTmF2aWdhdGlvbkl0ZW0oaXRlbVRvQWRkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9hZGQgYWJvdXQgbGlua1xuICAgICAgICB2YXIgYWJvdXRJdGVtID0ge1xuICAgICAgICAgIHRpdGxlOiBcIkFib3V0XCIsXG4gICAgICAgICAgdXJsOiBcIi9hYm91dFwiXG4gICAgICAgIH07XG5cbiAgICAgICAgbmF2aWdhdGlvblNlcnZpY2UuYWRkTmF2aWdhdGlvbkl0ZW0oYWJvdXRJdGVtKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmlzSXRlbUFjdGl2ZSA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgIHJldHVybiB1cmwgPT09ICRsb2NhdGlvbi5wYXRoKCk7XG4gICAgfTtcbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29tcG9uZW50KFwiZ3dSb29tXCIsIHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ3d3cvYXBwL2NvbXBvbmVudHMvcm9vbS9yb29tLmh0bVwiLFxuICAgIGNvbnRyb2xsZXI6IFwicm9vbUNvbXBvbmVudENvbnRyb2xsZXJcIixcbiAgICBjb250cm9sbGVyQXM6IFwiY3RybFwiXG5cbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG5cdGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29udHJvbGxlcihcInJvb21Db21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uICgkcm91dGVQYXJhbXMsIGFwcGxpY2F0aW9uU2V0dGluZ3MsIHJvb21TZXJ2aWNlKSB7XG5cdFx0dGhpcy4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0dGhpcy5pbml0Um9vbSgpO1xuXHRcdH07XG5cblx0XHR0aGlzLm9uU3VibWl0dGVkID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0Y29uc29sZS5sb2coXCJPdXIgZm9ybSBjb21wb25lbnQganVzdCB1cGRhdGVkIHJvb21Db21wb25lbnQgdGhyb3VnaCBvdXRwdXQgYmluZGluZ1wiKTtcblx0XHRcdHRoaXMuaW5pdFJvb20oKTtcblx0XHR9O1xuXG5cdFx0dGhpcy5pbml0Um9vbSA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cblx0XHRcdHRoaXMubG9hZGluZyA9IHRydWU7XG5cblx0XHRcdHJvb21TZXJ2aWNlLmdldFJvb21CeUlkKCRyb3V0ZVBhcmFtcy5pZCkudGhlbihmdW5jdGlvbiAocm9vbVJlc3VsdCkge1xuXHRcdFx0XHRfdGhpcy5yb29tID0gcm9vbVJlc3VsdDtcblxuXHRcdFx0XHQvLyBhdHRhY2ggaWQgdG8gcm9vbSBvYmplY3QgZm9yIGNvbnZlbmllbmNlXG5cdFx0XHRcdF90aGlzLnJvb20uaWQgPSAkcm91dGVQYXJhbXMuaWQ7XG5cblx0XHRcdFx0Ly8gdXBkYXRlIHJvb20gcGljdHVyZSB3aXRoIHBhdGggdG8gb3VyIGxvY2FsIGFzc2V0XG5cdFx0XHRcdF90aGlzLnJvb20ucGljdHVyZSA9IGFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0SW1hZ2VQYXRoKF90aGlzLnJvb20ucGljdHVyZSk7XG5cblx0XHRcdFx0Ly8gaGlkZSBsb2FkaW5nIFVJXG5cdFx0XHRcdF90aGlzLmxvYWRpbmcgPSBmYWxzZTtcblx0XHRcdH0pO1xuXHRcdH07XG5cdH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbXBvbmVudChcImd3Um9vbVJlc2VydmF0aW9uTGlzdFwiLCB7XG4gICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb20vcm9vbS1yZXNlcnZhdGlvbi1saXN0L3Jvb20tcmVzZXJ2YXRpb24tbGlzdC5odG1cIixcbiAgICBjb250cm9sbGVyOiBcInJvb21SZXNlcnZhdGlvbkxpc3RDb21wb25lbnRDb250cm9sbGVyXCIsXG4gICAgY29udHJvbGxlckFzOiBcImN0cmxcIixcbiAgICByZXF1aXJlOiB7XG4gICAgICBwYXJlbnRDb250cm9sbGVyOiBcIl5nd1Jvb21cIlxuICAgIH1cblxuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJyb29tUmVzZXJ2YXRpb25MaXN0Q29tcG9uZW50Q29udHJvbGxlclwiLCBmdW5jdGlvbiAoKSB7fSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29tcG9uZW50KFwiZ3dSb29tUmVzZXJ2YXRpb25Gb3JtXCIsIHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ3d3cvYXBwL2NvbXBvbmVudHMvcm9vbS9yb29tLXJlc2VydmF0aW9uLWZvcm0vcm9vbS1yZXNlcnZhdGlvbi1mb3JtLmh0bVwiLFxuICAgIGNvbnRyb2xsZXI6IFwicm9vbVJlc2VydmF0aW9uRm9ybUNvbnRyb2xsZXJcIixcbiAgICBjb250cm9sbGVyQXM6IFwiY3RybFwiLFxuICAgIGJpbmRpbmdzOiB7XG4gICAgICByb29tOiBcIjxcIixcbiAgICAgIG9uU3VibWl0dGVkOiBcIiZcIlxuICAgIH1cblxuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcblx0YW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb250cm9sbGVyKFwicm9vbVJlc2VydmF0aW9uRm9ybUNvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKHJvb21TZXJ2aWNlKSB7XG5cdFx0dGhpcy4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0dGhpcy5zdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xuXHRcdFx0dGhpcy5zdGFydFRpbWUuc2V0SG91cnMoMTIsIDAsIDAsIDApO1xuXG5cdFx0XHR0aGlzLmVuZFRpbWUgPSBuZXcgRGF0ZSgpO1xuXHRcdFx0dGhpcy5lbmRUaW1lLnNldEhvdXJzKDEyLCAwLCAwLCAwKTtcblxuXHRcdFx0dGhpcy5yZXNlcnZlUmVhc29ucyA9IFtcIkJpcnRoZGF5XCIsIFwiQ29uZmVyZW5jZVwiLCBcIkludGVydmlld1wiLCBcIlNjcnVtIE1lZXRpbmdcIiwgXCJDbGllbnQgTWVldGluZ1wiLCBcIkhvbmV5bW9vblwiXTtcblxuXHRcdFx0dGhpcy5yb29tU3VibWlzc2lvbiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0Ly8gc29tZSBjb250cm9sbGVyLXNpZGUgZm9ybSB2YWxpZGF0aW9uIGRvbmUgaGVyZVxuXHRcdFx0XHRpZiAodGhpcy5nZXRNaW5UaW1lKCkgPj0gdGhpcy5lbmRUaW1lKSByZXR1cm4gdGhpcy5teUZvcm0uZW5kVGltZS4kc2V0VmFsaWRpdHkoXCJtaW5cIiwgZmFsc2UpO1xuXG5cdFx0XHRcdHZhciByZXNlcnZhdGlvblN1Ym1pc3Npb24gPSB7fTtcblx0XHRcdFx0cmVzZXJ2YXRpb25TdWJtaXNzaW9uLmVtYWlsID0gdGhpcy5lbWFpbDE7XG5cdFx0XHRcdHJlc2VydmF0aW9uU3VibWlzc2lvbi5zdGFydFRpbWUgPSB0aGlzLnN0YXJ0VGltZTtcblx0XHRcdFx0cmVzZXJ2YXRpb25TdWJtaXNzaW9uLmVuZFRpbWUgPSB0aGlzLmVuZFRpbWU7XG5cdFx0XHRcdHJlc2VydmF0aW9uU3VibWlzc2lvbi5zcGVjaWFsSW5zdHJ1Y3Rpb25zID0gdGhpcy5zcGVjaWFsSW5zdHJ1Y3Rpb25zO1xuXHRcdFx0XHRyZXNlcnZhdGlvblN1Ym1pc3Npb24ucmVzZXJ2ZVJlYXNvbiA9IHRoaXMucmVzZXJ2ZVJlYXNvbjtcblxuXHRcdFx0XHRyZXR1cm4gcm9vbVNlcnZpY2Uud3JpdGVSb29tUmVzZXJ2YXRpb24odGhpcy5yb29tLmlkLCByZXNlcnZhdGlvblN1Ym1pc3Npb24pLnRoZW4odGhpcy5vblN1Ym1pdHRlZCgpKS5jYXRjaChmdW5jdGlvbiAocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRyZXR1cm4gYWxlcnQocmVzcG9uc2UuZGF0YS5lcnJvcik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy5nZXRNaW5UaW1lID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHR2YXIgZGF0ZSA9IG5ldyBEYXRlKHRoaXMuc3RhcnRUaW1lKTtcblx0XHRcdFx0ZGF0ZS5zZXRIb3VycyhkYXRlLmdldEhvdXJzKCkgKyAuOSk7XG5cblx0XHRcdFx0cmV0dXJuIGRhdGU7XG5cdFx0XHR9O1xuXHRcdH07XG5cdH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbXBvbmVudChcImd3Um9vbVN0YXR1c0hlYWRlclwiLCB7XG4gICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb20vcm9vbS1zdGF0dXMtaGVhZGVyL3Jvb20tc3RhdHVzLWhlYWRlci5odG1cIixcbiAgICBjb250cm9sbGVyOiBcInJvb21TdGF0dXNIZWFkZXJDb21wb25lbnRDb250cm9sbGVyXCIsXG4gICAgY29udHJvbGxlckFzOiBcImN0cmxcIixcbiAgICBiaW5kaW5nczoge1xuICAgICAgcm9vbTogXCJAXCJcbiAgICB9XG5cbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb250cm9sbGVyKFwicm9vbVN0YXR1c0hlYWRlckNvbXBvbmVudENvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCkge30pO1xufSkod2luZG93LmFuZ3VsYXIpOyIsIihmdW5jdGlvbihhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIiwgW1wibmdSb3V0ZVwiXSlcblxuICAgIC5jb25zdGFudChcImFwcGxpY2F0aW9uU2V0dGluZ3NcIiwge1xuICAgICAgYXBwbGljYXRpb25UaXRsZTogXCJHZWVrd2lzZSBSb29tIFJlc2VydmUgQXBwXCIsXG5cbiAgICAgIGdldEZpcmViYXNlUmVzdFVybDogZnVuY3Rpb24oc3VmZml4KSB7XG4gICAgICAgIGNvbnN0IHByZWZpeCA9IFwiaHR0cHM6Ly9jb25mZGVjb25mbGljdG9yLmZpcmViYXNlaW8uY29tL1wiO1xuICAgICAgICBjb25zdCBleHQgPSBcIi5qc29uXCI7XG5cbiAgICAgICAgcmV0dXJuIHByZWZpeCArIHN1ZmZpeCArIGV4dDtcbiAgICAgIH0sXG5cbiAgICAgIGdldEltYWdlUGF0aDogZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICByZXR1cm4gYHd3dy9hc3NldHMvaW1hZ2VzLyR7ZmlsZX1gO1xuICAgICAgfVxuICAgIH0pXG5cblxuICAgIC5jb25maWcoW1wiJGxvY2F0aW9uUHJvdmlkZXJcIiwgXCIkcm91dGVQcm92aWRlclwiLCBmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHJvdXRlUHJvdmlkZXIpIHtcbiAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgICAgLy8gY29uc29sZS5sb2coXCJGaW5kIE1lXCIpO1xuXG4gICAgICAkcm91dGVQcm92aWRlclxuXHRcdFx0XHQud2hlbihcIi9yb29tLzppZFwiLCB7XG5cdFx0XHRcdFx0dGVtcGxhdGUgOiBcIjxndy1yb29tPjwvZ3ctcm9vbT5cIlxuXHRcdFx0XHR9KVxuXHRcdFx0XHQud2hlbihcIi93ZWxjb21lXCIsIHtcblx0XHRcdFx0XHR0ZW1wbGF0ZSA6IFwiPGd3LWxvZ2luPjwvZ3ctbG9naW4+XCJcblx0XHRcdFx0fSlcblx0XHRcdFx0LndoZW4oXCIvYWJvdXRcIiwge1xuXHRcdFx0XHRcdHRlbXBsYXRlIDogXCI8Z3ctbG9naW4+PC9ndy1sb2dpbj5cIlxuXHRcdFx0XHR9KVxuXHRcdFx0XHQub3RoZXJ3aXNlKHtcblx0XHRcdFx0XHR0ZW1wbGF0ZSA6IFwiPGd3LWxvZ2luPjwvZ3ctbG9naW4+XCJcblx0XHRcdFx0fSk7XG4gICAgfV0pO1xuICAgIFxuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuICAgIC5jb250cm9sbGVyKFwiZXhlcmNpc2VPbmVDb250cm9sbGVyXCIsIGZ1bmN0aW9uKGVzKSB7IC8vaW5qZWN0XG5cbiAgICAgIHRoaXMuZXhlcmNpc2VTZXJ2aWNlID0gZXM7IC8vZXhwb3NlXG5cbiAgICAgIHRoaXMudGl0bGUgPSBcIkV4ZXJjaXNlIDEsIGluIHRoZSBjb250cm9sbGVyXCI7XG5cblx0XHRcdHRoaXMuY2xpY2tBY3Rpb24gPSAoKSA9PiB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKHRoaXMpO1xuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy5zdHVkZW50cyA9IFtcblx0XHRcdFx0eyBuYW1lOiBcIkpvaG5cIiB9LFxuXHRcdFx0XHR7IG5hbWU6IFwiSm9zaFwiIH0sXG5cdFx0XHRcdHsgbmFtZTogXCJNYWNrXCIgfVxuXHRcdFx0XTtcblxufSlcblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29udHJvbGxlcihcImV4ZXJjaXNlVHdvQ29udHJvbGxlclwiLCBmdW5jdGlvbihlcykgeyAvL2luamVjdFxuXG4gICAgICB0aGlzLmV4ZXJjaXNlU2VydmljZSA9IGVzOyAvL2V4cG9zZVxuXG4gICAgICB0aGlzLnRpdGxlID0gXCJFeGVyY2lzZSAyXCI7XG5cblxuICAgICAgY29uc3Qgb3JpZ2luYWxCdXR0b25UZXh0ID0gXCJCdXR0b24gVGV4dFwiO1xuICAgICAgdGhpcy5idXR0b25UZXh0ID0gb3JpZ2luYWxCdXR0b25UZXh0O1xuXG4gICAgICB0aGlzLnBvc3NpYmxlQ29sb3JzID0gW1xuICAgICAgICB7bmFtZSAgOiBcIkJyb3duXCIsXG4gICAgICAgIGhleCAgIDogXCIjYTUyXCJ9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZSA6IFwiQmx1ZVwiLFxuICAgICAgICAgIGhleCA6IFwiIzAwMDBGRlwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lIDogXCJHYWluc2Jvcm9cIixcbiAgICAgICAgICBoZXggOiBcIiNkY2RjZGNcIlxuICAgICAgICB9XG4gICAgICBdO1xuXG4gICAgICB0aGlzLl9nZXRSYW5kb21Db2xvciA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgcmFuZG9tQ29sb3IgPSB0aGlzLnBvc3NpYmxlQ29sb3JzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMucG9zc2libGVDb2xvcnMubGVuZ3RoKV07XG4gICAgICAgIHJldHVybiByYW5kb21Db2xvcjtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuX2NyZWF0ZU9iamVjdCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgcmV0dXJuT2JqZWN0ID0ge1xuICAgICAgICAgIG5hbWUgICAgICAgOiBcIk9ialwiICsgKHRoaXMub2JqZWN0QXJyYXkubGVuZ3RoICsgMSksXG4gICAgICAgICAgY2xpY2tDb3VudCA6IDAsXG4gICAgICAgICAgY29sb3IgOiB0aGlzLl9nZXRSYW5kb21Db2xvcigpLmhleFxuICAgICAgICB9O1xuICAgICAgICBjb25zb2xlLmxvZyhyZXR1cm5PYmplY3QpO1xuICAgICAgICByZXR1cm4gcmV0dXJuT2JqZWN0O1xuICAgICAgfTtcblxuXG4gICAgICB0aGlzLmJ1dHRvbk1vdXNlRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYnV0dG9uVGV4dCA9IFwiTmV3IEJ1dHRvbiBUZXh0XCI7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmJ1dHRvblJlc2V0Q2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuYnV0dG9uVGV4dCA9IG9yaWdpbmFsQnV0dG9uVGV4dDtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMub2JqZWN0QXJyYXkgPSBbXTtcblxuICAgICAgdGhpcy5jb250cm9sbGVySW5pdE9iamVjdCA9IHRoaXMuX2NyZWF0ZU9iamVjdCgpO1xuXG5cbiAgICAgIC8vdGhpcy5jb250cm9sbGVySW5pdE9iamVjdC5jbGlja0NvdW50ID0gNTtcblxuICAgICAgdGhpcy5hZGROZXdPYmplY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5vYmplY3RBcnJheS5wdXNoKHRoaXMuX2NyZWF0ZU9iamVjdCgpKTtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuYWRkQ2xpY2tDb3VudCA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgb2JqLmNsaWNrQ291bnQrKztcbiAgICAgICAgY29uc29sZS5sb2cob2JqLm5hbWUsIG9iai5jbGlja0NvdW50KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jb2xvcmZpbHRlckNoYW5nZWQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZmlsdGVyLmNvbG9yKTtcbiAgICAgICAgaWYoIXRoaXMuZmlsdGVyLmNvbG9yKSBkZWxldGUgdGhpcy5maWx0ZXIuY29sb3I7XG4gICAgICB9XG5cblxuICAgIH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKGFuZ3VsYXIpIHtcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuICAgIC5zZXJ2aWNlKFwiZXNcIiwgZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmxvZ2dlZEluVXNlciA9IHt9O1xuICAgICAgdGhpcy5sb2dpbiA9IGxvZ2luO1xuICAgICAgdGhpcy5sb2dvdXQgPSBsb2dvdXQ7XG5cblxuXG4gICAgICAvL2ltcGxlbWVudGF0aW9uXG4gICAgICBmdW5jdGlvbiBwcmludENvbnNvbGUgKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk91ciB2ZXJ5IGZpcnN0IGluamVjdGFibGVcIik7XG4gICAgICB9O1xuXG4gICAgICBmdW5jdGlvbiBsb2dpbiAoKSB7XG4gICAgICAgIHRoaXMubG9nZ2VkSW5Vc2VyID0ge1xuICAgICAgICAgIG5hbWUgOiBcInVzZXJOYW1lXCIsXG4gICAgICAgICAgcGhvdG86ICgnaHR0cHM6Ly91bnNwbGFzaC5jb20vP3Bob3RvPWVoTkdvQjZxNXA0JyksXG4gICAgICAgICAgdXNlclBhc3N3b3JkIDogXCJwYXNzd29yZFwiLFxuICAgICAgICAgIGRhdGUgOiBEYXRlLm5vdyxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5sb2dnZWRJblVzZXIpO1xuXG4gICAgICB9O1xuXG5cbiAgICAgIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgICAgICAgdGhpcy5sb2dnZWRJblVzZXIgPSB7fTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5sb2dnZWRJblVzZXIpO1xuICAgICAgfTtcblxuICAgIH0pXG4gICAgLmZhY3RvcnkoXCJlc1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZ2V0TG9nZ2VkSW5Vc2VyLFxuICAgICAgICAgICAgICAgIGxvZ2luLFxuICAgICAgICAgICAgICAgIGxvZ291dFxuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICBsZXQgbG9nZ2VkSW5Vc2VyID0geyB0ZXN0IDogXCJ0ZXN0XCIgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TG9nZ2VkSW5Vc2VyKCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiR2V0dGluZyBsb2dnZWRJblVzZXJcIiwgbG9nZ2VkSW5Vc2VyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbG9nZ2VkSW5Vc2VyO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBsb2dpbigpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIldlJ3JlIGhlcmUgZmFjdG9yeSBzdHlsZVwiKTtcbiAgICAgICAgICAgICAgICBkZWJ1Z2dlcjtcblxuICAgICAgICAgICAgICAgIGxvZ2dlZEluVXNlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSAgICAgIDogXCJUZWRcIixcbiAgICAgICAgICAgICAgICAgICAgcGhvdG8gICAgIDogXCJhbmd1bGFyaWNvbi5qcGdcIixcbiAgICAgICAgICAgICAgICAgICAgbG9naW5UaW1lIDogRGF0ZS5ub3coKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gbG9nb3V0KCkge1xuICAgICAgICAgICAgICAgIGxvZ2dlZEluVXNlciA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKGFuZ3VsYXIpIHtcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuICAgIC5mYWN0b3J5KFwibG9naW5TZXJ2aWNlXCIsIGZ1bmN0aW9uKCRyb290U2NvcGUpIHtcbiAgICAgIGxldCBsb2dnZWRJblVzZXIgPSBudWxsO1xuICAgICAgbGV0IG5vdGlmeUNvbnRyb2xsZXJDYWxsYmFjayA9IG51bGw7XG5cbiAgICAgIC8vYWN0aXZlbHkgbGlzdGVucyBGaXJlYmFzZSBhdXRoZW50aWNhdGlvbiBhbmQgZmlyZXMgY2FsbGJhY2tcbiAgICAgIGZpcmViYXNlLmF1dGgoKS5vbkF1dGhTdGF0ZUNoYW5nZWQodXBkYXRlTG9naW5TdGF0dXMpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXRMb2dnZWRJblVzZXIsXG4gICAgICAgIGxvZ2luLFxuICAgICAgICBsb2dvdXRcbiAgICAgIH07XG5cbiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUxvZ2luU3RhdHVzKGF1dGhlbnRpY2F0ZWRVc2VyKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGF1dGhlbnRpY2F0ZWRVc2VyKTtcblxuICAgICAgICBsb2dnZWRJblVzZXIgPSBhdXRoZW50aWNhdGVkVXNlcjtcbiAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gZ2V0TG9nZ2VkSW5Vc2VyKCkge1xuICAgICAgICByZXR1cm4gbG9nZ2VkSW5Vc2VyO1xuICAgICAgfTtcblxuICAgICAgZnVuY3Rpb24gbG9naW4oKSB7XG5cbiAgICAgICAgcmV0dXJuIGZpcmViYXNlLmF1dGgoKS5zaWduSW5XaXRoUG9wdXAobmV3IGZpcmViYXNlLmF1dGguR2l0aHViQXV0aFByb3ZpZGVyKCkpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gICAgICAgIGxvZ2dlZEluVXNlciA9IG51bGw7XG4gICAgICAgIHJldHVybiBmaXJlYmFzZS5hdXRoKCkuc2lnbk91dCgpO1xuICAgICAgfVxuICAgIH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuXG4gICAgICAgIC5mYWN0b3J5KFwibmF2aWdhdGlvblNlcnZpY2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBnZXROYXZpZ2F0aW9uLFxuICAgICAgICAgICAgICAgIGFkZE5hdmlnYXRpb25JdGVtLFxuICAgICAgICAgICAgICAgIHJlbW92ZU5hdmlnYXRpb25JdGVtXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgbmF2aWdhdGlvbkl0ZW1zID0gW107XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldE5hdmlnYXRpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRpb25JdGVtcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gYWRkTmF2aWdhdGlvbkl0ZW0oaXRlbSkge1xuICAgICAgICAgICAgICAgIGlmICghbmF2aWdhdGlvbkl0ZW1zKSBuYXZpZ2F0aW9uSXRlbXMgPSBbXTtcbiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uSXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gcmVtb3ZlTmF2aWdhdGlvbkl0ZW0oaXRlbSkge1xuICAgICAgICAgICAgICAgIG5hdmlnYXRpb25JdGVtcy5mb3JFYWNoKChpdGVtSW5OYXZpZ2F0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbUluTmF2aWdhdGlvbi5pZCA9PT0gaXRlbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbkl0ZW1zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcblx0YW5ndWxhclxuXHRcdC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuXG5cdFx0LmZhY3RvcnkoXCJyb29tU2VydmljZVwiLCBmdW5jdGlvbiAoJGh0dHAsIGFwcGxpY2F0aW9uU2V0dGluZ3MpIHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdGdldFJvb21CeUlkLFxuXHRcdFx0XHRmZXRjaFJvb21zRnJvbURCLFxuXHRcdFx0XHRyZXNldFJvb21zVG9EQixcblx0XHRcdFx0d3JpdGVSb29tUmVzZXJ2YXRpb24sXG5cdFx0XHRcdGdldFJvb21EYXRlS2V5XG5cdFx0XHR9O1xuXG5cdFx0XHRmdW5jdGlvbiBnZXRSb29tQnlJZChpZCkge1xuXHRcdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KGFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0RmlyZWJhc2VSZXN0VXJsKGByb29tcy8ke2lkfWApKVxuXHRcdFx0XHRcdC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmRhdGEpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBmZXRjaFJvb21zRnJvbURCKCkge1xuXHRcdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KGFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0RmlyZWJhc2VSZXN0VXJsKFwicm9vbXNcIikpXG5cdFx0XHRcdFx0LnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHJlc2V0Um9vbXNUb0RCKCkge1xuXHRcdFx0XHRjb25zdCB1cmwgPSBhcHBsaWNhdGlvblNldHRpbmdzLmdldEZpcmViYXNlUmVzdFVybChcInJvb21zXCIpO1xuXG5cdFx0XHRcdHJldHVybiAkaHR0cC5kZWxldGUodXJsKVxuXHRcdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRcdHJldHVybiAkaHR0cC5wdXQodXJsLCB7XG5cdFx0XHRcdFx0XHRcdGhhbG86IHtcblx0XHRcdFx0XHRcdFx0XHRuYW1lOiBcIkhhbG9cIixcblx0XHRcdFx0XHRcdFx0XHRwaWN0dXJlOiAnaGFsby5qcGcnXG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdHNvbmljOiB7XG5cdFx0XHRcdFx0XHRcdFx0bmFtZTogXCJTb25pY1wiLFxuXHRcdFx0XHRcdFx0XHRcdHBpY3R1cmU6ICdzb25pYy5qcGcnXG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdHplbGRhOiB7XG5cdFx0XHRcdFx0XHRcdFx0bmFtZTogXCJaZWxkYVwiLFxuXHRcdFx0XHRcdFx0XHRcdHBpY3R1cmU6ICd6ZWxkYS5qcGcnXG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdHN0YXJmb3g6IHtcblx0XHRcdFx0XHRcdFx0XHRuYW1lOiBcIlN0YXIgRm94XCIsXG5cdFx0XHRcdFx0XHRcdFx0cGljdHVyZTogJ3N0YXJmb3guanBnJ1xuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHRzaW1jaXR5OiB7XG5cdFx0XHRcdFx0XHRcdFx0bmFtZTogXCJTaW0gQ2l0eVwiLFxuXHRcdFx0XHRcdFx0XHRcdHBpY3R1cmU6ICdzaW1jaXR5LmpwZydcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQudGhlbihmZXRjaFJvb21zRnJvbURCKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gd3JpdGVSb29tUmVzZXJ2YXRpb24oaWQsIHJlc2VydmF0aW9uKSB7XG5cdFx0XHRcdHJldHVybiBnZXRSb29tQnlJZChpZClcblx0XHRcdFx0XHQudGhlbihyb29tID0+IHtcblx0XHRcdFx0XHRcdC8vIHdlIGdldCByb29tIHNvIHNvbWUgdmFsaWRhdGlvbiBjb3VsZCBiZSBwZXJmb3JtZWQgaGVyZSBiZWZvcmUgd2UgcG9zdCwgdGhvdWdoIG5vdGUgdGhpcyBkb2Vzbid0XG5cdFx0XHRcdFx0XHQvLyBlbGltaW5hdGUgcmFjZSBjb25kaXRpb25zXG5cblx0XHRcdFx0XHRcdC8vIGN1cnJlbnRseSwgdGhpcyBqdXN0IHBvc3RzIHRvIHRoZSBjdXJyZW50IGRhdGUgYmVjYXVzZSBub3RoaW5nIGlzIHBhc3NlZCBpbiBnZXRSb29tRGF0ZUtleVxuXHRcdFx0XHRcdFx0cmV0dXJuICRodHRwLnBvc3QoYXBwbGljYXRpb25TZXR0aW5ncy5nZXRGaXJlYmFzZVJlc3RVcmwoYHJvb21zLyR7aWR9L3Jlc2VydmF0aW9ucy8ke2dldFJvb21EYXRlS2V5KCl9YCksIHJlc2VydmF0aW9uKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZ2V0Um9vbURhdGVLZXkoZGF0ZSkge1xuXHRcdFx0XHRsZXQgZGF0ZUtleTtcblxuXHRcdFx0XHRkYXRlS2V5ID0gZGF0ZSA/IG5ldyBEYXRlKGRhdGUpLnRvRGF0ZVN0cmluZygpIDogbmV3IERhdGUoKS50b0RhdGVTdHJpbmcoKTtcblx0XHRcdFx0ZGF0ZUtleSA9IGRhdGVLZXkucmVwbGFjZSgvIC9nLCBcIlwiKTtcblxuXHRcdFx0XHRyZXR1cm4gZGF0ZUtleTtcblx0XHRcdH1cblx0XHR9KTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyXG4gICAgLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXG4gICAgLmNvbXBvbmVudChcImd3TG9naW5cIiwge1xuICAgICAgdGVtcGxhdGVVcmwgOiBcInd3dy9hcHAvY29tcG9uZW50cy9sb2dpbi9sb2dpbi5odG1cIixcbiAgICAgIGNvbnRyb2xsZXIgIDogXCJsb2dpbkNvbXBvbmVudENvbnRyb2xsZXJcIixcbiAgICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCJcbiAgICB9KTtcbn0gKHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoIGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29udHJvbGxlcihcImxvZ2luQ29tcG9uZW50Q29udHJvbGxlclwiLCBmdW5jdGlvbigkc2NvcGUsIGxvZ2luU2VydmljZSl7XG4gICAgICB0aGlzLmxvZ2luU2VydmljZSA9IGxvZ2luU2VydmljZTtcblxuICAgICAgdGhpcy5nZXRMb2dnZWRJblVzZXIgPSBsb2dpblNlcnZpY2UuZ2V0TG9nZ2VkSW5Vc2VyO1xuXG4gICAgICB0aGlzLnJlZnJlc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJDb250cm9sbGVyIHJlZnJlc2ggY2FsbGVkXCIpO1xuICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XG4gICAgICB9XG5cbiAgICB9KTtcbn0gKHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuICAgIC5jb21wb25lbnQoXCJnd05hdmlnYXRpb25cIiwge1xuICAgICAgdGVtcGxhdGVVcmwgOiBcInd3dy9hcHAvY29tcG9uZW50cy9uYXZpZ2F0aW9uL25hdmlnYXRpb24uaHRtXCIsXG4gICAgICBjb250cm9sbGVyICA6IFwibmF2aWdhdGlvbkNvbXBvbmVudENvbnRyb2xsZXJcIixcbiAgICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCJcbiAgICB9KTtcbn0gKHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24oYW5ndWxhcikge1xuICBhbmd1bGFyXG4gICAgLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXG4gICAgLmNvbnRyb2xsZXIoXCJuYXZpZ2F0aW9uQ29tcG9uZW50Q29udHJvbGxlclwiLCBmdW5jdGlvbigkbG9jYXRpb24sIG5hdmlnYXRpb25TZXJ2aWNlLCByb29tU2VydmljZSkge1xuICAgICAgdGhpcy4kb25Jbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvblNlcnZpY2UgPSBuYXZpZ2F0aW9uU2VydmljZTtcblxuXG4gICAgICAgIGxldCB3ZWxjb21lSXRlbSA9IHtcbiAgICAgICAgICB0aXRsZTogXCJXZWxjb21lXCIsXG4gICAgICAgICAgdXJsOiBcIi93ZWxjb21lXCJcbiAgICAgICAgfTtcblxuICAgICAgICBuYXZpZ2F0aW9uU2VydmljZS5hZGROYXZpZ2F0aW9uSXRlbSh3ZWxjb21lSXRlbSk7XG5cbiAgICAgICAgLy9hZGQgcm9vbXNcbiAgICAgICAgcm9vbVNlcnZpY2UuZmV0Y2hSb29tc0Zyb21EQigpLnRoZW4ocm9vbXMgPT4ge1xuXG4gICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJvb21zLCBmdW5jdGlvbihvYmplY3RWYWx1ZSwgb2JqZWN0S2V5KSB7XG5cdFx0XHRcdFx0XHRjb25zdCBpdGVtVG9BZGQgPSB7XG5cdFx0XHRcdFx0XHRcdHRpdGxlIDogb2JqZWN0VmFsdWUubmFtZSxcblx0XHRcdFx0XHRcdFx0dXJsICAgOiBgL3Jvb20vJHtvYmplY3RLZXl9YFxuXHRcdFx0XHRcdFx0fTtcbiAgICAgICAgICAgIG5hdmlnYXRpb25TZXJ2aWNlLmFkZE5hdmlnYXRpb25JdGVtKGl0ZW1Ub0FkZCk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvL2FkZCBhYm91dCBsaW5rXG4gICAgICAgICAgbGV0IGFib3V0SXRlbSA9IHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkFib3V0XCIsXG4gICAgICAgICAgICB1cmw6IFwiL2Fib3V0XCJcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgbmF2aWdhdGlvblNlcnZpY2UuYWRkTmF2aWdhdGlvbkl0ZW0oYWJvdXRJdGVtKTtcbiAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5pc0l0ZW1BY3RpdmUgPSBmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgcmV0dXJuIHVybCA9PT0gJGxvY2F0aW9uLnBhdGgoKTtcbiAgICAgIH07XG5cblxuXG4gICAgfSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuICAgIC5jb21wb25lbnQoXCJnd1Jvb21cIiwge1xuICAgICAgdGVtcGxhdGVVcmwgICA6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb20vcm9vbS5odG1cIixcbiAgICAgIGNvbnRyb2xsZXIgICAgOiBcInJvb21Db21wb25lbnRDb250cm9sbGVyXCIsXG4gICAgICBjb250cm9sbGVyQXMgIDogXCJjdHJsXCJcblxuICAgIH0pO1xufSAod2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbiAoYW5ndWxhcikge1xyXG5cdGFuZ3VsYXJcclxuXHRcdC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxyXG5cclxuXHRcdC5jb250cm9sbGVyKFwicm9vbUNvbXBvbmVudENvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCRyb3V0ZVBhcmFtcywgYXBwbGljYXRpb25TZXR0aW5ncywgcm9vbVNlcnZpY2UpIHtcclxuXHRcdFx0dGhpcy4kb25Jbml0ID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0dGhpcy5pbml0Um9vbSgpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0dGhpcy5vblN1Ym1pdHRlZCA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKFwiT3VyIGZvcm0gY29tcG9uZW50IGp1c3QgdXBkYXRlZCByb29tQ29tcG9uZW50IHRocm91Z2ggb3V0cHV0IGJpbmRpbmdcIik7XHJcblx0XHRcdFx0dGhpcy5pbml0Um9vbSgpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0dGhpcy5pbml0Um9vbSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHRoaXMubG9hZGluZyA9IHRydWU7XHJcblxyXG5cdFx0XHRcdHJvb21TZXJ2aWNlLmdldFJvb21CeUlkKCRyb3V0ZVBhcmFtcy5pZClcclxuXHRcdFx0XHRcdC50aGVuKHJvb21SZXN1bHQgPT4ge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnJvb20gPSByb29tUmVzdWx0O1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gYXR0YWNoIGlkIHRvIHJvb20gb2JqZWN0IGZvciBjb252ZW5pZW5jZVxyXG5cdFx0XHRcdFx0XHR0aGlzLnJvb20uaWQgPSAkcm91dGVQYXJhbXMuaWQ7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyB1cGRhdGUgcm9vbSBwaWN0dXJlIHdpdGggcGF0aCB0byBvdXIgbG9jYWwgYXNzZXRcclxuXHRcdFx0XHRcdFx0dGhpcy5yb29tLnBpY3R1cmUgPSBhcHBsaWNhdGlvblNldHRpbmdzLmdldEltYWdlUGF0aCh0aGlzLnJvb20ucGljdHVyZSk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBoaWRlIGxvYWRpbmcgVUlcclxuXHRcdFx0XHRcdFx0dGhpcy5sb2FkaW5nID0gZmFsc2U7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcbn0od2luZG93LmFuZ3VsYXIpKTtcclxuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29tcG9uZW50KFwiZ3dSb29tUmVzZXJ2YXRpb25MaXN0XCIsIHtcbiAgICAgIHRlbXBsYXRlVXJsICAgOiBcInd3dy9hcHAvY29tcG9uZW50cy9yb29tL3Jvb20tcmVzZXJ2YXRpb24tbGlzdC9yb29tLXJlc2VydmF0aW9uLWxpc3QuaHRtXCIsXG4gICAgICBjb250cm9sbGVyICAgIDogXCJyb29tUmVzZXJ2YXRpb25MaXN0Q29tcG9uZW50Q29udHJvbGxlclwiLFxuICAgICAgY29udHJvbGxlckFzICA6IFwiY3RybFwiLFxuICAgICAgcmVxdWlyZSAgICAgICA6IHtcbiAgICAgICAgcGFyZW50Q29udHJvbGxlciA6IFwiXmd3Um9vbVwiXG4gICAgICB9XG5cbiAgICB9KTtcbn0gKHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwicm9vbVJlc2VydmF0aW9uTGlzdENvbXBvbmVudENvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29tcG9uZW50KFwiZ3dSb29tUmVzZXJ2YXRpb25Gb3JtXCIsIHtcbiAgICAgIHRlbXBsYXRlVXJsICAgOiBcInd3dy9hcHAvY29tcG9uZW50cy9yb29tL3Jvb20tcmVzZXJ2YXRpb24tZm9ybS9yb29tLXJlc2VydmF0aW9uLWZvcm0uaHRtXCIsXG4gICAgICBjb250cm9sbGVyICAgIDogXCJyb29tUmVzZXJ2YXRpb25Gb3JtQ29udHJvbGxlclwiLFxuICAgICAgY29udHJvbGxlckFzICA6IFwiY3RybFwiLFxuICAgICAgYmluZGluZ3MgICAgICA6IHtcbiAgICAgICAgcm9vbSAgICAgICAgOiBcIjxcIixcblx0XHRcdFx0b25TdWJtaXR0ZWQgOiBcIiZcIlxuICAgICAgfVxuXG4gICAgfSk7XG59ICh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XHJcblx0YW5ndWxhclxyXG5cdFx0Lm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXHJcblxyXG5cdFx0LmNvbnRyb2xsZXIoXCJyb29tUmVzZXJ2YXRpb25Gb3JtQ29udHJvbGxlclwiLCBmdW5jdGlvbihyb29tU2VydmljZSkge1xyXG5cdFx0XHR0aGlzLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0dGhpcy5zdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xyXG5cdFx0XHRcdHRoaXMuc3RhcnRUaW1lLnNldEhvdXJzKDEyLCAwLCAwLCAwKTtcclxuXHJcblx0XHRcdFx0dGhpcy5lbmRUaW1lID0gbmV3IERhdGUoKTtcclxuXHRcdFx0XHR0aGlzLmVuZFRpbWUuc2V0SG91cnMoMTIsIDAsIDAsIDApO1xyXG5cclxuXHRcdFx0XHR0aGlzLnJlc2VydmVSZWFzb25zID0gW1xyXG5cdFx0XHRcdFx0XCJCaXJ0aGRheVwiLFxyXG5cdFx0XHRcdFx0XCJDb25mZXJlbmNlXCIsXHJcblx0XHRcdFx0XHRcIkludGVydmlld1wiLFxyXG5cdFx0XHRcdFx0XCJTY3J1bSBNZWV0aW5nXCIsXHJcblx0XHRcdFx0XHRcIkNsaWVudCBNZWV0aW5nXCIsXHJcblx0XHRcdFx0XHRcIkhvbmV5bW9vblwiXHJcblx0XHRcdFx0XTtcclxuXHJcblx0XHRcdFx0dGhpcy5yb29tU3VibWlzc2lvbiA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0Ly8gc29tZSBjb250cm9sbGVyLXNpZGUgZm9ybSB2YWxpZGF0aW9uIGRvbmUgaGVyZVxyXG5cdFx0XHRcdFx0aWYgKHRoaXMuZ2V0TWluVGltZSgpID49IHRoaXMuZW5kVGltZSkgcmV0dXJuIHRoaXMubXlGb3JtLmVuZFRpbWUuJHNldFZhbGlkaXR5KFwibWluXCIsIGZhbHNlKTtcclxuXHJcblx0XHRcdFx0XHRjb25zdCByZXNlcnZhdGlvblN1Ym1pc3Npb24gPSB7fTtcclxuXHRcdFx0XHRcdHJlc2VydmF0aW9uU3VibWlzc2lvbi5lbWFpbCA9IHRoaXMuZW1haWwxO1xyXG5cdFx0XHRcdFx0cmVzZXJ2YXRpb25TdWJtaXNzaW9uLnN0YXJ0VGltZSA9IHRoaXMuc3RhcnRUaW1lO1xyXG5cdFx0XHRcdFx0cmVzZXJ2YXRpb25TdWJtaXNzaW9uLmVuZFRpbWUgPSB0aGlzLmVuZFRpbWU7XHJcblx0XHRcdFx0XHRyZXNlcnZhdGlvblN1Ym1pc3Npb24uc3BlY2lhbEluc3RydWN0aW9ucyA9IHRoaXMuc3BlY2lhbEluc3RydWN0aW9ucztcclxuXHRcdFx0XHRcdHJlc2VydmF0aW9uU3VibWlzc2lvbi5yZXNlcnZlUmVhc29uID0gdGhpcy5yZXNlcnZlUmVhc29uO1xyXG5cclxuXHRcdFx0XHRcdHJldHVybiByb29tU2VydmljZS53cml0ZVJvb21SZXNlcnZhdGlvbih0aGlzLnJvb20uaWQsIHJlc2VydmF0aW9uU3VibWlzc2lvbilcclxuXHRcdFx0XHRcdFx0LnRoZW4odGhpcy5vblN1Ym1pdHRlZCgpKVxyXG5cdFx0XHRcdFx0XHQuY2F0Y2gocmVzcG9uc2UgPT4gYWxlcnQocmVzcG9uc2UuZGF0YS5lcnJvcikpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dGhpcy5nZXRNaW5UaW1lID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0bGV0IGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnN0YXJ0VGltZSk7XHJcblx0XHRcdFx0XHRkYXRlLnNldEhvdXJzKGRhdGUuZ2V0SG91cnMoKSArIC45KTtcclxuXHJcblx0XHRcdFx0XHRyZXR1cm4gZGF0ZTtcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxufSh3aW5kb3cuYW5ndWxhcikpO1xyXG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuICAgIC5jb21wb25lbnQoXCJnd1Jvb21TdGF0dXNIZWFkZXJcIiwge1xuICAgICAgdGVtcGxhdGVVcmwgICA6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb20vcm9vbS1zdGF0dXMtaGVhZGVyL3Jvb20tc3RhdHVzLWhlYWRlci5odG1cIixcbiAgICAgIGNvbnRyb2xsZXIgICAgOiBcInJvb21TdGF0dXNIZWFkZXJDb21wb25lbnRDb250cm9sbGVyXCIsXG4gICAgICBjb250cm9sbGVyQXMgIDogXCJjdHJsXCIsXG4gICAgICBiaW5kaW5ncyAgICAgICA6IHtcbiAgICAgICAgcm9vbSA6IFwiQFwiXG4gICAgICB9XG5cbiAgICB9KTtcbn0gKHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwicm9vbVN0YXR1c0hlYWRlckNvbXBvbmVudENvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIl19

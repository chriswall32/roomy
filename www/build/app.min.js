"use strict";!function(o){o.module("application",["ngRoute"]).config(["$locationProvider","$routeProvider",function(o,n){o.html5Mode(!0),n.when("/room/:id",{resolve:{isLoggedIn:["$location","loginService",function(o,n){return!!n.getLoggedInUser()||o.path("/welcome")}]},template:"<gw-room></gw-room>"}).otherwise({template:"<gw-login></gw-login>"})}])}(window.angular),function(o){o.module("application").controller("exerciseOneController",["es",function(o){var n=this;this.exerciseService=o,this.title="Exercise 1, in the controller",this.clickAction=function(){console.log(n)},this.students=[{name:"John"},{name:"Josh"},{name:"Mack"}]}])}(window.angular),function(o){o.module("application").controller("exerciseTwoController",["es",function(o){var n=this;this.exerciseService=o,this.title="Exercise 2";this.buttonText="Button Text",this.possibleColors=[{name:"Brown",hex:"#a52"},{name:"Blue",hex:"#0000FF"},{name:"Gainsboro",hex:"#dcdcdc"}],this._getRandomColor=function(){return n.possibleColors[Math.floor(Math.random()*n.possibleColors.length)]},this._createObject=function(){var o={name:"Obj"+(n.objectArray.length+1),clickCount:0,color:n._getRandomColor().hex};return console.log(o),o},this.buttonMouseEnter=function(){this.buttonText="New Button Text"},this.buttonResetClick=function(){n.buttonText="Button Text"},this.objectArray=[],this.controllerInitObject=this._createObject(),this.addNewObject=function(){this.objectArray.push(this._createObject())},this.addClickCount=function(o){o.clickCount++,console.log(o.name,o.clickCount)},this.colorfilterChanged=function(){console.log(n.filter.color),n.filter.color||delete n.filter.color}}])}(window.angular),function(o){o.module("application").service("es",function(){function o(){this.loggedInUser={name:"userName",photo:"https://unsplash.com/?photo=ehNGoB6q5p4",userPassword:"password",date:Date.now},console.log(this.loggedInUser)}function n(){this.loggedInUser={},console.log(this.loggedInUser)}this.loggedInUser={},this.login=o,this.logout=n}).factory("es",function(){function o(){return console.log("Getting loggedInUser",e),e}function n(){console.log("We're here factory style"),e={name:"Ted",photo:"angularicon.jpg",loginTime:Date.now()}}function t(){e={}}return{getLoggedInUser:o,login:n,logout:t};var e})}(window.angular),function(o){o.module("application").factory("loginService",function(){function o(){return i}function n(o){console.log(o),i=o,r&&r()}function t(o){return r=o,firebase.auth().signInWithPopup(new firebase.auth.GithubAuthProvider)}function e(){return i=null,firebase.auth().signOut()}var i=null,r=null;return firebase.auth().onAuthStateChanged(n),{getLoggedInUser:o,login:t,logout:e}})}(window.angular),function(o){o.module("application").factory("navigationService",function(){function o(){return e}function n(o){e||(e=[]),e.push(o)}function t(o){e.forEach(function(n,t){n.id===o.id&&e.splice(t,1)})}return{getNavigation:o,addNavigationItem:n,removeNavigationItem:t};var e})}(window.angular),function(o){o.module("application").factory("roomService",["$timeout",function(o){function n(){return i}function t(n){return o(function(){var o=null;return i.forEach(function(t){n==t.id&&(o=t)}),o},1500)}function e(){return o(function(){return i=[{name:"Halo",id:1,picture:"www/assets/images/halo.jpg"},{name:"Sonic",id:2,picture:"www/assets/images/sonic.jpg"},{name:"Zelda",id:3,picture:"www/assets/images/zelda.jpg"},{name:"Star Fox",id:4,picture:"www/assets/images/starfox.jpg"}]},1500)}var i=null;return{getRooms:n,getRoomById:t,fetchRoomsFromDB:e}}])}(window.angular),function(o){o.module("application").component("gwLogin",{templateUrl:"www/app/components/login/login.htm",controller:"loginComponentController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("loginComponentController",["$scope","loginService",function(o,n){this.loginService=n,this.getLoggedInUser=n.getLoggedInUser,this.refresh=function(){console.log("Controller refresh called"),o.$apply()}}])}(window.angular),function(o){o.module("application").component("gwNavigation",{templateUrl:"www/app/components/navigation/navigation.htm",controller:"navigationComponentController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("navigationComponentController",["$location","navigationService","roomService",function(o,n,t){this.$onInit=function(){this.navigationService=n,this.roomService=t,t.fetchRoomsFromDB()},this.isItemActive=function(n){return n===o.path()}}])}(window.angular),function(o){o.module("application").component("gwRoom",{templateUrl:"www/app/components/room/room.htm",controller:"roomComponentController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("roomComponentController",["roomService","$routeParams",function(o,n){this.$onInit=function(){var t=this;console.log(this),this.loading=!0,this.startTime=new Date,this.startTime.setHours(0,0,0,0),this.endTime=new Date,this.endTime.setHours(0,0,0,0),this.reserveReasons=["Birthday","Conference","Interview","Scrum Meeting","Honeymoon"],o.getRoomById(n.id).then(function(o){t.room=o,t.loading=!1})},this.roomSubmission=function(){return this.getMinTime()>=this.endTime?(this.myForm.endTime.$setValidity("min",!1),alert("Message from controller: time invalid")):this.myForm.$invalid?alert("Message from controller: form invalid"):void alert("Room submitted")},this.getMinTime=function(){var o=new Date(this.startTime);return o.setHours(o.getHours()+1),o}}])}(window.angular),function(o){o.module("application").component("gwRoomReservationForm",{templateUrl:"www/app/components/room/room-reservation-form/room-reservation-form.htm",controller:"roomReservationFormComponentController",controllerAs:"ctrl",bindings:{room:"<"}})}(window.angular),function(o){o.module("application").controller("roomReservationFormComponentController",function(){this.$onInit=function(){var o=this;this.loading=!0,this.startTime=new Date,this.startTime.setHours(0,0,0,0),this.endTime=new Date,this.endTime.setHours(0,0,0,0),this.reserveReasons=["Birthday","Conference","Interview","Scrum Meeting","Honeymoon"],roomService.getRoomById($routeParams.id).then(function(n){o.room=n,o.loading=!1})},this.roomSubmission=function(){return this.room.reservations||(this.room.reservations=[]),console.log("Reserving for",this.room),console.log(this.myForm),this.getMinTime()>=this.endTime?(this.myForm.endTime.$setValidity("min",!1),alert("Message from controller: time invalid")):this.myForm.$invalid?alert("Message from controller: form invalid"):void alert("Room submitted")},this.getMinTime=function(){var o=new Date(this.startTime);return o.setHours(o.getHours()+1),o}})}(window.angular),function(o){o.module("application").component("gwRoomReservationList",{templateUrl:"www/app/components/room/room-reservation-list/room-reservation-list.htm",controller:"roomReservationListComponentController",controllerAs:"ctrl",require:{parentController:"^gwRoom"}})}(window.angular),function(o){o.module("application").controller("roomReservationListComponentController",function(){})}(window.angular),function(o){o.module("application").component("gwRoomStatusHeader",{templateUrl:"www/app/components/room/room-status-header/room-status-header.htm",controller:"roomStatusHeaderComponentController",controllerAs:"ctrl",bindings:{room:"@"}})}(window.angular),function(o){o.module("application").controller("roomStatusHeaderComponentController",function(){})}(window.angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5taW4uanMiLCJpbmRleC5qcyIsImNvbnRyb2xsZXJzL2V4ZXJjaXNlT25lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2V4ZXJjaXNlVHdvQ29udHJvbGxlci5qcyIsInNlcnZpY2VzL2V4ZXJjaXNlVHdvU2VydmljZXMuanMiLCJzZXJ2aWNlcy9sb2dpbi5zZXJ2aWNlLmpzIiwic2VydmljZXMvbmF2aWdhdGlvbi5zZXJ2aWNlLmpzIiwic2VydmljZXMvcm9vbS5zZXJ2aWNlLmpzIiwiY29tcG9uZW50cy9sb2dpbi9sb2dpbi5jb21wb25lbnQuanMiLCJjb21wb25lbnRzL2xvZ2luL2xvZ2luLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL25hdmlnYXRpb24vbmF2aWdhdGlvbi5jb21wb25lbnQuanMiLCJjb21wb25lbnRzL25hdmlnYXRpb24vbmF2aWdhdGlvbi5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9yb29tL3Jvb20uY29tcG9uZW50LmpzIiwiY29tcG9uZW50cy9yb29tL3Jvb20uY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvcm9vbS9yb29tLXJlc2VydmF0aW9uLWZvcm0vcm9vbS1yZXNlcnZhdGlvbi1mb3JtLmNvbXBvbmVudC5qcyIsImNvbXBvbmVudHMvcm9vbS9yb29tLXJlc2VydmF0aW9uLWZvcm0vcm9vbS1yZXNlcnZhdGlvbi1mb3JtLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL3Jvb20vcm9vbS1yZXNlcnZhdGlvbi1saXN0L3Jvb20tcmVzZXJ2YXRpb24tbGlzdC5jb21wb25lbnQuanMiLCJjb21wb25lbnRzL3Jvb20vcm9vbS1yZXNlcnZhdGlvbi1saXN0L3Jvb20tcmVzZXJ2YXRpb24tbGlzdC5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9yb29tL3Jvb20tc3RhdHVzLWhlYWRlci9yb29tLXN0YXR1cy1oZWFkZXIuY29tcG9uZW50LmpzIiwiY29tcG9uZW50cy9yb29tL3Jvb20tc3RhdHVzLWhlYWRlci9yb29tLXN0YXR1cy1oZWFkZXIuY29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJyZXNvbHZlIiwiaXNMb2dnZWRJbiIsIiRsb2NhdGlvbiIsImxvZ2luU2VydmljZSIsImdldExvZ2dlZEluVXNlciIsInBhdGgiLCJ0ZW1wbGF0ZSIsIm90aGVyd2lzZSIsIndpbmRvdyIsImNvbnRyb2xsZXIiLCJlcyIsIl90aGlzIiwidGhpcyIsImV4ZXJjaXNlU2VydmljZSIsInRpdGxlIiwiY2xpY2tBY3Rpb24iLCJjb25zb2xlIiwibG9nIiwic3R1ZGVudHMiLCJuYW1lIiwiYnV0dG9uVGV4dCIsInBvc3NpYmxlQ29sb3JzIiwiaGV4IiwiX2dldFJhbmRvbUNvbG9yIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibGVuZ3RoIiwiX2NyZWF0ZU9iamVjdCIsInJldHVybk9iamVjdCIsIm9iamVjdEFycmF5IiwiY2xpY2tDb3VudCIsImNvbG9yIiwiYnV0dG9uTW91c2VFbnRlciIsImJ1dHRvblJlc2V0Q2xpY2siLCJjb250cm9sbGVySW5pdE9iamVjdCIsImFkZE5ld09iamVjdCIsInB1c2giLCJhZGRDbGlja0NvdW50Iiwib2JqIiwiY29sb3JmaWx0ZXJDaGFuZ2VkIiwiZmlsdGVyIiwic2VydmljZSIsImxvZ2luIiwibG9nZ2VkSW5Vc2VyIiwicGhvdG8iLCJ1c2VyUGFzc3dvcmQiLCJkYXRlIiwiRGF0ZSIsIm5vdyIsImxvZ291dCIsImZhY3RvcnkiLCJsb2dpblRpbWUiLCJ1cGRhdGVMb2dpblN0YXR1cyIsImF1dGhlbnRpY2F0ZWRVc2VyIiwibm90aWZ5Q29udHJvbGxlckNhbGxiYWNrIiwiY2FsbGJhY2siLCJmaXJlYmFzZSIsImF1dGgiLCJzaWduSW5XaXRoUG9wdXAiLCJHaXRodWJBdXRoUHJvdmlkZXIiLCJzaWduT3V0Iiwib25BdXRoU3RhdGVDaGFuZ2VkIiwiZ2V0TmF2aWdhdGlvbiIsIm5hdmlnYXRpb25JdGVtcyIsImFkZE5hdmlnYXRpb25JdGVtIiwiaXRlbSIsInJlbW92ZU5hdmlnYXRpb25JdGVtIiwiZm9yRWFjaCIsIml0ZW1Jbk5hdmlnYXRpb24iLCJpbmRleCIsImlkIiwic3BsaWNlIiwiJHRpbWVvdXQiLCJnZXRSb29tcyIsInJvb21zIiwiZ2V0Um9vbUJ5SWQiLCJyb29tVG9SZXR1cm4iLCJyb29tIiwiZmV0Y2hSb29tc0Zyb21EQiIsInBpY3R1cmUiLCJjb21wb25lbnQiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXJBcyIsIiRzY29wZSIsInJlZnJlc2giLCIkYXBwbHkiLCJuYXZpZ2F0aW9uU2VydmljZSIsInJvb21TZXJ2aWNlIiwiJG9uSW5pdCIsImlzSXRlbUFjdGl2ZSIsInVybCIsIiRyb3V0ZVBhcmFtcyIsImxvYWRpbmciLCJzdGFydFRpbWUiLCJzZXRIb3VycyIsImVuZFRpbWUiLCJyZXNlcnZlUmVhc29ucyIsInRoZW4iLCJyb29tUmVzdWx0Iiwicm9vbVN1Ym1pc3Npb24iLCJnZXRNaW5UaW1lIiwibXlGb3JtIiwiJHNldFZhbGlkaXR5IiwiYWxlcnQiLCIkaW52YWxpZCIsImdldEhvdXJzIiwiYmluZGluZ3MiLCJyZXNlcnZhdGlvbnMiLCJyZXF1aXJlIiwicGFyZW50Q29udHJvbGxlciJdLCJtYXBwaW5ncyI6IkFBQUEsY0NBRSxTQUFTQSxHQUNUQSxFQUNHQyxPQUFPLGVBQWdCLFlBR3ZCQyxRQUFRLG9CQUFxQixpQkFBa0IsU0FBU0MsRUFBbUJDLEdBQzFFRCxFQUFrQkUsV0FBVSxHQUk1QkQsRUFDR0UsS0FBSyxhQUNKQyxTQUNKQyxZQUFBQSxZQUFBQSxlQUFhLFNBQVNDLEVBQVdDLEdBQ2hDLFFBQVFBLEVBQWFDLG1CQUFvQkYsRUFBVUcsS0FBSyxlQUdyREMsU0FBVyx3QkFFWkMsV0FDQ0QsU0FBVSw4QkFJbEJFLE9BQU9mLFNDeEJSLFNBQVVBLEdBQ1RBLEVBQ0dDLE9BQU8sZUFDUGUsV0FBVyx5QkFBQSxL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QUtrRSxLQUFLOEIsaUJBR1o1RixRQUFRQyxJQUFJLGdCQUFpQkwsS0FBS2tFLE1BQ2xDOUQsUUFBUUMsSUFBSUwsS0FBSzBGLFFBRWpCMUYsS0FBS3lGLGNBQWdCekYsS0FBS29GLFNBQzdCcEYsS0FBSzBGLE9BQU9OLFFBQVFPLGFBQWEsT0FBTyxHQUVqQ0MsTUFBTSwwQ0FHVjVGLEtBQUswRixPQUFPRyxTQUFpQkQsTUFBTSw2Q0FFdkNBLE9BQU0sbUJBR1A1RixLQUFLeUYsV0FBYSxXQUNqQixHQUFJdEQsR0FBTyxHQUFJQyxNQUFLcEMsS0FBS2tGLFVBR3pCLE9BRkEvQyxHQUFLZ0QsU0FBU2hELEVBQUsyRCxXQUFhLEdBRXpCM0QsTUFLYnZDLE9BQU9mLFNDekRSLFNBQVVBLEdBQ1RBLEVBQ0dDLE9BQU8sZUFDUHVGLFVBQVUseUJBQ1RDLFlBQWdCLDBFQUNoQnpFLFdBQWdCLHlDQUNoQjBFLGFBQWdCLE9BQ2hCMEIsU0FDRUMsaUJBQW1CLGNBSXhCdEcsT0FBT2YsU0NaVCxTQUFVQSxHQUNQQSxFQUNLQyxPQUFPLGVBRVBlLFdBQVcseUNBQTBDLGVBRzVERCxPQUFPZixTQ1BSLFNBQVVBLEdBQ1RBLEVBQ0dDLE9BQU8sZUFDUHVGLFVBQVUsc0JBQ1RDLFlBQWdCLG9FQUNoQnpFLFdBQWdCLHNDQUNoQjBFLGFBQWdCLE9BQ2hCd0IsVUFDRTdCLEtBQU8sUUFJWnRFLE9BQU9mLFNDWlQsU0FBVUEsR0FDUEEsRUFDS0MsT0FBTyxlQUVQZSxXQUFXLHNDQUF1QyxlQUd6REQsT0FBT2YiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiLCBbXCJuZ1JvdXRlXCJdKS5jb25maWcoW1wiJGxvY2F0aW9uUHJvdmlkZXJcIiwgXCIkcm91dGVQcm92aWRlclwiLCBmdW5jdGlvbiAoJGxvY2F0aW9uUHJvdmlkZXIsICRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgLy8gY29uc29sZS5sb2coXCJGaW5kIE1lXCIpO1xuXG4gICAgJHJvdXRlUHJvdmlkZXIud2hlbihcIi9yb29tLzppZFwiLCB7XG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIGlzTG9nZ2VkSW46IGZ1bmN0aW9uIGlzTG9nZ2VkSW4oJGxvY2F0aW9uLCBsb2dpblNlcnZpY2UpIHtcbiAgICAgICAgICByZXR1cm4gIWxvZ2luU2VydmljZS5nZXRMb2dnZWRJblVzZXIoKSA/ICRsb2NhdGlvbi5wYXRoKFwiL3dlbGNvbWVcIikgOiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6IFwiPGd3LXJvb20+PC9ndy1yb29tPlwiXG4gICAgfSkub3RoZXJ3aXNlKHtcbiAgICAgIHRlbXBsYXRlOiBcIjxndy1sb2dpbj48L2d3LWxvZ2luPlwiXG4gICAgfSk7XG4gIH1dKTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcblx0YW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb250cm9sbGVyKFwiZXhlcmNpc2VPbmVDb250cm9sbGVyXCIsIGZ1bmN0aW9uIChlcykge1xuXHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cblx0XHQvL2luamVjdFxuXG5cdFx0dGhpcy5leGVyY2lzZVNlcnZpY2UgPSBlczsgLy9leHBvc2VcblxuXHRcdHRoaXMudGl0bGUgPSBcIkV4ZXJjaXNlIDEsIGluIHRoZSBjb250cm9sbGVyXCI7XG5cblx0XHR0aGlzLmNsaWNrQWN0aW9uID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0Y29uc29sZS5sb2coX3RoaXMpO1xuXHRcdH07XG5cblx0XHR0aGlzLnN0dWRlbnRzID0gW3sgbmFtZTogXCJKb2huXCIgfSwgeyBuYW1lOiBcIkpvc2hcIiB9LCB7IG5hbWU6IFwiTWFja1wiIH1dO1xuXHR9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb250cm9sbGVyKFwiZXhlcmNpc2VUd29Db250cm9sbGVyXCIsIGZ1bmN0aW9uIChlcykge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAvL2luamVjdFxuXG4gICAgdGhpcy5leGVyY2lzZVNlcnZpY2UgPSBlczsgLy9leHBvc2VcblxuICAgIHRoaXMudGl0bGUgPSBcIkV4ZXJjaXNlIDJcIjtcblxuICAgIHZhciBvcmlnaW5hbEJ1dHRvblRleHQgPSBcIkJ1dHRvbiBUZXh0XCI7XG4gICAgdGhpcy5idXR0b25UZXh0ID0gb3JpZ2luYWxCdXR0b25UZXh0O1xuXG4gICAgdGhpcy5wb3NzaWJsZUNvbG9ycyA9IFt7IG5hbWU6IFwiQnJvd25cIixcbiAgICAgIGhleDogXCIjYTUyXCIgfSwge1xuICAgICAgbmFtZTogXCJCbHVlXCIsXG4gICAgICBoZXg6IFwiIzAwMDBGRlwiXG4gICAgfSwge1xuICAgICAgbmFtZTogXCJHYWluc2Jvcm9cIixcbiAgICAgIGhleDogXCIjZGNkY2RjXCJcbiAgICB9XTtcblxuICAgIHRoaXMuX2dldFJhbmRvbUNvbG9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJhbmRvbUNvbG9yID0gX3RoaXMucG9zc2libGVDb2xvcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogX3RoaXMucG9zc2libGVDb2xvcnMubGVuZ3RoKV07XG4gICAgICByZXR1cm4gcmFuZG9tQ29sb3I7XG4gICAgfTtcblxuICAgIHRoaXMuX2NyZWF0ZU9iamVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciByZXR1cm5PYmplY3QgPSB7XG4gICAgICAgIG5hbWU6IFwiT2JqXCIgKyAoX3RoaXMub2JqZWN0QXJyYXkubGVuZ3RoICsgMSksXG4gICAgICAgIGNsaWNrQ291bnQ6IDAsXG4gICAgICAgIGNvbG9yOiBfdGhpcy5fZ2V0UmFuZG9tQ29sb3IoKS5oZXhcbiAgICAgIH07XG4gICAgICBjb25zb2xlLmxvZyhyZXR1cm5PYmplY3QpO1xuICAgICAgcmV0dXJuIHJldHVybk9iamVjdDtcbiAgICB9O1xuXG4gICAgdGhpcy5idXR0b25Nb3VzZUVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5idXR0b25UZXh0ID0gXCJOZXcgQnV0dG9uIFRleHRcIjtcbiAgICB9O1xuXG4gICAgdGhpcy5idXR0b25SZXNldENsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgX3RoaXMuYnV0dG9uVGV4dCA9IG9yaWdpbmFsQnV0dG9uVGV4dDtcbiAgICB9O1xuXG4gICAgdGhpcy5vYmplY3RBcnJheSA9IFtdO1xuXG4gICAgdGhpcy5jb250cm9sbGVySW5pdE9iamVjdCA9IHRoaXMuX2NyZWF0ZU9iamVjdCgpO1xuXG4gICAgLy90aGlzLmNvbnRyb2xsZXJJbml0T2JqZWN0LmNsaWNrQ291bnQgPSA1O1xuXG4gICAgdGhpcy5hZGROZXdPYmplY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm9iamVjdEFycmF5LnB1c2godGhpcy5fY3JlYXRlT2JqZWN0KCkpO1xuICAgIH07XG5cbiAgICB0aGlzLmFkZENsaWNrQ291bnQgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICBvYmouY2xpY2tDb3VudCsrO1xuICAgICAgY29uc29sZS5sb2cob2JqLm5hbWUsIG9iai5jbGlja0NvdW50KTtcbiAgICB9O1xuXG4gICAgdGhpcy5jb2xvcmZpbHRlckNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZyhfdGhpcy5maWx0ZXIuY29sb3IpO1xuICAgICAgaWYgKCFfdGhpcy5maWx0ZXIuY29sb3IpIGRlbGV0ZSBfdGhpcy5maWx0ZXIuY29sb3I7XG4gICAgfTtcbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuc2VydmljZShcImVzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxvZ2dlZEluVXNlciA9IHt9O1xuICAgIHRoaXMubG9naW4gPSBsb2dpbjtcbiAgICB0aGlzLmxvZ291dCA9IGxvZ291dDtcblxuICAgIC8vaW1wbGVtZW50YXRpb25cbiAgICBmdW5jdGlvbiBwcmludENvbnNvbGUoKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk91ciB2ZXJ5IGZpcnN0IGluamVjdGFibGVcIik7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGxvZ2luKCkge1xuICAgICAgdGhpcy5sb2dnZWRJblVzZXIgPSB7XG4gICAgICAgIG5hbWU6IFwidXNlck5hbWVcIixcbiAgICAgICAgcGhvdG86ICdodHRwczovL3Vuc3BsYXNoLmNvbS8/cGhvdG89ZWhOR29CNnE1cDQnLFxuICAgICAgICB1c2VyUGFzc3dvcmQ6IFwicGFzc3dvcmRcIixcbiAgICAgICAgZGF0ZTogRGF0ZS5ub3dcbiAgICAgIH07XG4gICAgICBjb25zb2xlLmxvZyh0aGlzLmxvZ2dlZEluVXNlcik7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgICAgIHRoaXMubG9nZ2VkSW5Vc2VyID0ge307XG4gICAgICBjb25zb2xlLmxvZyh0aGlzLmxvZ2dlZEluVXNlcik7XG4gICAgfTtcbiAgfSkuZmFjdG9yeShcImVzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ2V0TG9nZ2VkSW5Vc2VyOiBnZXRMb2dnZWRJblVzZXIsXG4gICAgICBsb2dpbjogbG9naW4sXG4gICAgICBsb2dvdXQ6IGxvZ291dFxuICAgIH07XG5cbiAgICB2YXIgbG9nZ2VkSW5Vc2VyID0geyB0ZXN0OiBcInRlc3RcIiB9O1xuXG4gICAgZnVuY3Rpb24gZ2V0TG9nZ2VkSW5Vc2VyKCkge1xuICAgICAgY29uc29sZS5sb2coXCJHZXR0aW5nIGxvZ2dlZEluVXNlclwiLCBsb2dnZWRJblVzZXIpO1xuICAgICAgcmV0dXJuIGxvZ2dlZEluVXNlcjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2dpbigpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiV2UncmUgaGVyZSBmYWN0b3J5IHN0eWxlXCIpO1xuICAgICAgZGVidWdnZXI7XG5cbiAgICAgIGxvZ2dlZEluVXNlciA9IHtcbiAgICAgICAgbmFtZTogXCJUZWRcIixcbiAgICAgICAgcGhvdG86IFwiYW5ndWxhcmljb24uanBnXCIsXG4gICAgICAgIGxvZ2luVGltZTogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gICAgICBsb2dnZWRJblVzZXIgPSB7fTtcbiAgICB9XG4gIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmZhY3RvcnkoXCJsb2dpblNlcnZpY2VcIiwgZnVuY3Rpb24gKCkge1xuICAgIHZhciBsb2dnZWRJblVzZXIgPSBudWxsO1xuICAgIHZhciBub3RpZnlDb250cm9sbGVyQ2FsbGJhY2sgPSBudWxsO1xuXG4gICAgLy9hY3RpdmVseSBsaXN0ZW5zIEZpcmViYXNlIGF1dGhlbnRpY2F0aW9uIGFuZCBmaXJlcyBjYWxsYmFja1xuICAgIGZpcmViYXNlLmF1dGgoKS5vbkF1dGhTdGF0ZUNoYW5nZWQodXBkYXRlTG9naW5TdGF0dXMpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGdldExvZ2dlZEluVXNlcjogZ2V0TG9nZ2VkSW5Vc2VyLFxuICAgICAgbG9naW46IGxvZ2luLFxuICAgICAgbG9nb3V0OiBsb2dvdXRcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ2V0TG9nZ2VkSW5Vc2VyKCkge1xuICAgICAgcmV0dXJuIGxvZ2dlZEluVXNlcjtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gdXBkYXRlTG9naW5TdGF0dXMoYXV0aGVudGljYXRlZFVzZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKGF1dGhlbnRpY2F0ZWRVc2VyKTtcblxuICAgICAgbG9nZ2VkSW5Vc2VyID0gYXV0aGVudGljYXRlZFVzZXI7XG5cbiAgICAgIGlmIChub3RpZnlDb250cm9sbGVyQ2FsbGJhY2spIG5vdGlmeUNvbnRyb2xsZXJDYWxsYmFjaygpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvZ2luKGNhbGxiYWNrKSB7XG4gICAgICBub3RpZnlDb250cm9sbGVyQ2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgIHJldHVybiBmaXJlYmFzZS5hdXRoKCkuc2lnbkluV2l0aFBvcHVwKG5ldyBmaXJlYmFzZS5hdXRoLkdpdGh1YkF1dGhQcm92aWRlcigpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gICAgICBsb2dnZWRJblVzZXIgPSBudWxsO1xuICAgICAgcmV0dXJuIGZpcmViYXNlLmF1dGgoKS5zaWduT3V0KCk7XG4gICAgfVxuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmZhY3RvcnkoXCJuYXZpZ2F0aW9uU2VydmljZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXROYXZpZ2F0aW9uOiBnZXROYXZpZ2F0aW9uLFxuICAgICAgICAgICAgYWRkTmF2aWdhdGlvbkl0ZW06IGFkZE5hdmlnYXRpb25JdGVtLFxuICAgICAgICAgICAgcmVtb3ZlTmF2aWdhdGlvbkl0ZW06IHJlbW92ZU5hdmlnYXRpb25JdGVtXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIG5hdmlnYXRpb25JdGVtcyA9IFtdO1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldE5hdmlnYXRpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdGlvbkl0ZW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWRkTmF2aWdhdGlvbkl0ZW0oaXRlbSkge1xuICAgICAgICAgICAgaWYgKCFuYXZpZ2F0aW9uSXRlbXMpIG5hdmlnYXRpb25JdGVtcyA9IFtdO1xuICAgICAgICAgICAgbmF2aWdhdGlvbkl0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZW1vdmVOYXZpZ2F0aW9uSXRlbShpdGVtKSB7XG4gICAgICAgICAgICBuYXZpZ2F0aW9uSXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbUluTmF2aWdhdGlvbiwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbUluTmF2aWdhdGlvbi5pZCA9PT0gaXRlbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uSXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuXHRhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmZhY3RvcnkoXCJyb29tU2VydmljZVwiLCBmdW5jdGlvbiAoJHRpbWVvdXQpIHtcblx0XHR2YXIgcm9vbXMgPSBudWxsO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGdldFJvb21zOiBnZXRSb29tcyxcblx0XHRcdGdldFJvb21CeUlkOiBnZXRSb29tQnlJZCxcblx0XHRcdGZldGNoUm9vbXNGcm9tREI6IGZldGNoUm9vbXNGcm9tREJcblx0XHR9O1xuXG5cdFx0ZnVuY3Rpb24gZ2V0Um9vbXMoKSB7XG5cdFx0XHRyZXR1cm4gcm9vbXM7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0Um9vbUJ5SWQoaWQpIHtcblx0XHRcdHJldHVybiAkdGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHZhciByb29tVG9SZXR1cm4gPSBudWxsO1xuXG5cdFx0XHRcdHJvb21zLmZvckVhY2goZnVuY3Rpb24gKHJvb20pIHtcblx0XHRcdFx0XHRpZiAoaWQgPT0gcm9vbS5pZCkgcm9vbVRvUmV0dXJuID0gcm9vbTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIHJvb21Ub1JldHVybjtcblx0XHRcdH0sIDE1MDApO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGZldGNoUm9vbXNGcm9tREIoKSB7XG5cdFx0XHRyZXR1cm4gJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRyb29tcyA9IFt7XG5cdFx0XHRcdFx0bmFtZTogXCJIYWxvXCIsXG5cdFx0XHRcdFx0aWQ6IDEsXG5cdFx0XHRcdFx0cGljdHVyZTogJ3d3dy9hc3NldHMvaW1hZ2VzL2hhbG8uanBnJ1xuXHRcdFx0XHR9LCB7XG5cdFx0XHRcdFx0bmFtZTogXCJTb25pY1wiLFxuXHRcdFx0XHRcdGlkOiAyLFxuXHRcdFx0XHRcdHBpY3R1cmU6ICd3d3cvYXNzZXRzL2ltYWdlcy9zb25pYy5qcGcnXG5cdFx0XHRcdH0sIHtcblx0XHRcdFx0XHRuYW1lOiBcIlplbGRhXCIsXG5cdFx0XHRcdFx0aWQ6IDMsXG5cdFx0XHRcdFx0cGljdHVyZTogJ3d3dy9hc3NldHMvaW1hZ2VzL3plbGRhLmpwZydcblx0XHRcdFx0fSwge1xuXHRcdFx0XHRcdG5hbWU6IFwiU3RhciBGb3hcIixcblx0XHRcdFx0XHRpZDogNCxcblx0XHRcdFx0XHRwaWN0dXJlOiAnd3d3L2Fzc2V0cy9pbWFnZXMvc3RhcmZveC5qcGcnXG5cdFx0XHRcdH1dO1xuXG5cdFx0XHRcdHJldHVybiByb29tcztcblx0XHRcdH0sIDE1MDApO1xuXHRcdH1cblx0fSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblwidXNlIHN0cmljdFwiO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29tcG9uZW50KFwiZ3dMb2dpblwiLCB7XG4gICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL2xvZ2luL2xvZ2luLmh0bVwiLFxuICAgIGNvbnRyb2xsZXI6IFwibG9naW5Db21wb25lbnRDb250cm9sbGVyXCIsXG4gICAgY29udHJvbGxlckFzOiBcImN0cmxcIlxuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb250cm9sbGVyKFwibG9naW5Db21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uICgkc2NvcGUsIGxvZ2luU2VydmljZSkge1xuICAgIHRoaXMubG9naW5TZXJ2aWNlID0gbG9naW5TZXJ2aWNlO1xuXG4gICAgdGhpcy5nZXRMb2dnZWRJblVzZXIgPSBsb2dpblNlcnZpY2UuZ2V0TG9nZ2VkSW5Vc2VyO1xuXG4gICAgdGhpcy5yZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29uc29sZS5sb2coXCJDb250cm9sbGVyIHJlZnJlc2ggY2FsbGVkXCIpO1xuICAgICAgJHNjb3BlLiRhcHBseSgpO1xuICAgIH07XG4gIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbXBvbmVudChcImd3TmF2aWdhdGlvblwiLCB7XG4gICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL25hdmlnYXRpb24vbmF2aWdhdGlvbi5odG1cIixcbiAgICBjb250cm9sbGVyOiBcIm5hdmlnYXRpb25Db21wb25lbnRDb250cm9sbGVyXCIsXG4gICAgY29udHJvbGxlckFzOiBcImN0cmxcIlxuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb250cm9sbGVyKFwibmF2aWdhdGlvbkNvbXBvbmVudENvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCRsb2NhdGlvbiwgbmF2aWdhdGlvblNlcnZpY2UsIHJvb21TZXJ2aWNlKSB7XG4gICAgdGhpcy4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5uYXZpZ2F0aW9uU2VydmljZSA9IG5hdmlnYXRpb25TZXJ2aWNlO1xuICAgICAgdGhpcy5yb29tU2VydmljZSA9IHJvb21TZXJ2aWNlO1xuICAgICAgcm9vbVNlcnZpY2UuZmV0Y2hSb29tc0Zyb21EQigpO1xuXG4gICAgICAvLyBjb25zb2xlLmxvZyhcIk5hdmlnYXRpb25Jbml0XCIpO1xuXG4gICAgICAvLyBsZXQgd2VsY29tZUl0ZW0gPSB7XG4gICAgICAvLyAgIHRpdGxlOiBcIldlbGNvbWVcIixcbiAgICAgIC8vICAgdXJsOiBcIi93ZWxjb21lXCJcbiAgICAgIC8vIH07XG4gICAgICAvL1xuICAgICAgLy8gbmF2aWdhdGlvblNlcnZpY2UuYWRkTmF2aWdhdGlvbkl0ZW0od2VsY29tZUl0ZW0pO1xuXG4gICAgICAvLyBhZGQgcm9vbXNcbiAgICAgIC8vIGxldCByb29tcyA9IHJvb21TZXJ2aWNlLmZldGNoUm9vbXNGcm9tREIoKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKHJvb21zKTtcbiAgICAgIC8vIHJvb21zLmZvckVhY2goZnVuY3Rpb24ocm9vbSkge1xuICAgICAgLy8gICBjb25zb2xlLmxvZyhyb29tKTtcbiAgICAgIC8vICAgY29uc3QgaXRlbVRvQWRkID0ge1xuICAgICAgLy8gICAgIHRpdGxlOiByb29tLm5hbWUsXG4gICAgICAvLyAgICAgdXJsOiBcIi9yb29tLyQocm9vbS5pZClcIlxuICAgICAgLy8gICB9O1xuICAgICAgLy8gICBuYXZpZ2F0aW9uU2VydmljZS5hZGROYXZpZ2F0aW9uSXRlbShpdGVtVG9BZGQpO1xuICAgICAgLy8gfSk7XG5cbiAgICAgIC8vIGFkZCBhYm91dCBsaW5rXG4gICAgICAvLyAgIGxldCBhYm91dEl0ZW0gPSB7XG4gICAgICAvLyAgICAgdGl0bGU6IFwiQWJvdXRcIixcbiAgICAgIC8vICAgICB1cmw6IFwiL2Fib3V0XCJcbiAgICAgIC8vICAgfTtcbiAgICAgIC8vXG4gICAgICAvLyAgIG5hdmlnYXRpb25TZXJ2aWNlLmFkZE5hdmlnYXRpb25JdGVtKGFib3V0SXRlbSk7XG4gICAgICAvL1xuICAgIH07XG5cbiAgICB0aGlzLmlzSXRlbUFjdGl2ZSA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgIHJldHVybiB1cmwgPT09ICRsb2NhdGlvbi5wYXRoKCk7XG4gICAgfTtcbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29tcG9uZW50KFwiZ3dSb29tXCIsIHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ3d3cvYXBwL2NvbXBvbmVudHMvcm9vbS9yb29tLmh0bVwiLFxuICAgIGNvbnRyb2xsZXI6IFwicm9vbUNvbXBvbmVudENvbnRyb2xsZXJcIixcbiAgICBjb250cm9sbGVyQXM6IFwiY3RybFwiXG5cbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG5cdGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29udHJvbGxlcihcInJvb21Db21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uIChyb29tU2VydmljZSwgJHJvdXRlUGFyYW1zKSB7XG5cdFx0dGhpcy4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0dmFyIF90aGlzID0gdGhpcztcblxuXHRcdFx0Y29uc29sZS5sb2codGhpcyk7XG5cblx0XHRcdHRoaXMubG9hZGluZyA9IHRydWU7XG5cblx0XHRcdHRoaXMuc3RhcnRUaW1lID0gbmV3IERhdGUoKTtcblx0XHRcdHRoaXMuc3RhcnRUaW1lLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuXG5cdFx0XHR0aGlzLmVuZFRpbWUgPSBuZXcgRGF0ZSgpO1xuXHRcdFx0dGhpcy5lbmRUaW1lLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuXG5cdFx0XHR0aGlzLnJlc2VydmVSZWFzb25zID0gW1wiQmlydGhkYXlcIiwgXCJDb25mZXJlbmNlXCIsIFwiSW50ZXJ2aWV3XCIsIFwiU2NydW0gTWVldGluZ1wiLCBcIkhvbmV5bW9vblwiXTtcblxuXHRcdFx0cm9vbVNlcnZpY2UuZ2V0Um9vbUJ5SWQoJHJvdXRlUGFyYW1zLmlkKS50aGVuKGZ1bmN0aW9uIChyb29tUmVzdWx0KSB7XG5cdFx0XHRcdF90aGlzLnJvb20gPSByb29tUmVzdWx0O1xuXHRcdFx0XHRfdGhpcy5sb2FkaW5nID0gZmFsc2U7XG5cdFx0XHR9KTtcblx0XHR9O1xuXG5cdFx0dGhpcy5yb29tU3VibWlzc2lvbiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdGlmICh0aGlzLmdldE1pblRpbWUoKSA+PSB0aGlzLmVuZFRpbWUpIHtcblx0XHRcdFx0dGhpcy5teUZvcm0uZW5kVGltZS4kc2V0VmFsaWRpdHkoXCJtaW5cIiwgZmFsc2UpO1xuXG5cdFx0XHRcdHJldHVybiBhbGVydChcIk1lc3NhZ2UgZnJvbSBjb250cm9sbGVyOiB0aW1lIGludmFsaWRcIik7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLm15Rm9ybS4kaW52YWxpZCkgcmV0dXJuIGFsZXJ0KFwiTWVzc2FnZSBmcm9tIGNvbnRyb2xsZXI6IGZvcm0gaW52YWxpZFwiKTtcblxuXHRcdFx0YWxlcnQoXCJSb29tIHN1Ym1pdHRlZFwiKTtcblx0XHR9O1xuXG5cdFx0dGhpcy5nZXRNaW5UaW1lID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0dmFyIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnN0YXJ0VGltZSk7XG5cdFx0XHRkYXRlLnNldEhvdXJzKGRhdGUuZ2V0SG91cnMoKSArIDEpO1xuXG5cdFx0XHRyZXR1cm4gZGF0ZTtcblx0XHR9O1xuXHR9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb21wb25lbnQoXCJnd1Jvb21SZXNlcnZhdGlvbkZvcm1cIiwge1xuICAgIHRlbXBsYXRlVXJsOiBcInd3dy9hcHAvY29tcG9uZW50cy9yb29tL3Jvb20tcmVzZXJ2YXRpb24tZm9ybS9yb29tLXJlc2VydmF0aW9uLWZvcm0uaHRtXCIsXG4gICAgY29udHJvbGxlcjogXCJyb29tUmVzZXJ2YXRpb25Gb3JtQ29tcG9uZW50Q29udHJvbGxlclwiLFxuICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCIsXG4gICAgYmluZGluZ3M6IHtcbiAgICAgIHJvb206IFwiPFwiXG4gICAgfVxuXG4gIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJyb29tUmVzZXJ2YXRpb25Gb3JtQ29tcG9uZW50Q29udHJvbGxlclwiLCBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgdGhpcy5zdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgdGhpcy5zdGFydFRpbWUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG5cbiAgICAgIHRoaXMuZW5kVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICB0aGlzLmVuZFRpbWUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG5cbiAgICAgIHRoaXMucmVzZXJ2ZVJlYXNvbnMgPSBbXCJCaXJ0aGRheVwiLCBcIkNvbmZlcmVuY2VcIiwgXCJJbnRlcnZpZXdcIiwgXCJTY3J1bSBNZWV0aW5nXCIsIFwiSG9uZXltb29uXCJdO1xuXG4gICAgICByb29tU2VydmljZS5nZXRSb29tQnlJZCgkcm91dGVQYXJhbXMuaWQpLnRoZW4oZnVuY3Rpb24gKHJvb21SZXN1bHQpIHtcbiAgICAgICAgX3RoaXMucm9vbSA9IHJvb21SZXN1bHQ7XG4gICAgICAgIF90aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLnJvb21TdWJtaXNzaW9uID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICBpZiAoIXRoaXMucm9vbS5yZXNlcnZhdGlvbnMpIHtcbiAgICAgICAgdGhpcy5yb29tLnJlc2VydmF0aW9ucyA9IFtdO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhcIlJlc2VydmluZyBmb3JcIiwgdGhpcy5yb29tKTtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMubXlGb3JtKTtcblxuICAgICAgaWYgKHRoaXMuZ2V0TWluVGltZSgpID49IHRoaXMuZW5kVGltZSkge1xuICAgICAgICB0aGlzLm15Rm9ybS5lbmRUaW1lLiRzZXRWYWxpZGl0eShcIm1pblwiLCBmYWxzZSk7XG5cbiAgICAgICAgcmV0dXJuIGFsZXJ0KFwiTWVzc2FnZSBmcm9tIGNvbnRyb2xsZXI6IHRpbWUgaW52YWxpZFwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMubXlGb3JtLiRpbnZhbGlkKSByZXR1cm4gYWxlcnQoXCJNZXNzYWdlIGZyb20gY29udHJvbGxlcjogZm9ybSBpbnZhbGlkXCIpO1xuXG4gICAgICBhbGVydChcIlJvb20gc3VibWl0dGVkXCIpO1xuICAgIH07XG5cbiAgICB0aGlzLmdldE1pblRpbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKHRoaXMuc3RhcnRUaW1lKTtcbiAgICAgIGRhdGUuc2V0SG91cnMoZGF0ZS5nZXRIb3VycygpICsgMSk7XG5cbiAgICAgIHJldHVybiBkYXRlO1xuICAgIH07XG4gIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbXBvbmVudChcImd3Um9vbVJlc2VydmF0aW9uTGlzdFwiLCB7XG4gICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb20vcm9vbS1yZXNlcnZhdGlvbi1saXN0L3Jvb20tcmVzZXJ2YXRpb24tbGlzdC5odG1cIixcbiAgICBjb250cm9sbGVyOiBcInJvb21SZXNlcnZhdGlvbkxpc3RDb21wb25lbnRDb250cm9sbGVyXCIsXG4gICAgY29udHJvbGxlckFzOiBcImN0cmxcIixcbiAgICByZXF1aXJlOiB7XG4gICAgICBwYXJlbnRDb250cm9sbGVyOiBcIl5nd1Jvb21cIlxuICAgIH1cblxuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJyb29tUmVzZXJ2YXRpb25MaXN0Q29tcG9uZW50Q29udHJvbGxlclwiLCBmdW5jdGlvbiAoKSB7fSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29tcG9uZW50KFwiZ3dSb29tU3RhdHVzSGVhZGVyXCIsIHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ3d3cvYXBwL2NvbXBvbmVudHMvcm9vbS9yb29tLXN0YXR1cy1oZWFkZXIvcm9vbS1zdGF0dXMtaGVhZGVyLmh0bVwiLFxuICAgIGNvbnRyb2xsZXI6IFwicm9vbVN0YXR1c0hlYWRlckNvbXBvbmVudENvbnRyb2xsZXJcIixcbiAgICBjb250cm9sbGVyQXM6IFwiY3RybFwiLFxuICAgIGJpbmRpbmdzOiB7XG4gICAgICByb29tOiBcIkBcIlxuICAgIH1cblxuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJyb29tU3RhdHVzSGVhZGVyQ29tcG9uZW50Q29udHJvbGxlclwiLCBmdW5jdGlvbiAoKSB7fSk7XG59KSh3aW5kb3cuYW5ndWxhcik7IiwiKCBmdW5jdGlvbihhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIiwgW1wibmdSb3V0ZVwiXSlcblxuXG4gICAgLmNvbmZpZyhbXCIkbG9jYXRpb25Qcm92aWRlclwiLCBcIiRyb3V0ZVByb3ZpZGVyXCIsIGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkcm91dGVQcm92aWRlcikge1xuICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG5cdFx0XHQvLyBjb25zb2xlLmxvZyhcIkZpbmQgTWVcIik7XG5cbiAgICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgIC53aGVuKFwiL3Jvb20vOmlkXCIsIHtcbiAgICAgICAgICByZXNvbHZlICA6IHtcblx0XHRcdFx0XHRcdGlzTG9nZ2VkSW4gOiBmdW5jdGlvbigkbG9jYXRpb24sIGxvZ2luU2VydmljZSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gIWxvZ2luU2VydmljZS5nZXRMb2dnZWRJblVzZXIoKSA/ICRsb2NhdGlvbi5wYXRoKFwiL3dlbGNvbWVcIikgOiB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0sXG4gICAgICAgICAgdGVtcGxhdGUgOiBcIjxndy1yb29tPjwvZ3ctcm9vbT5cIlxuICAgICAgICB9KVxuICAgICAgICAub3RoZXJ3aXNlKHtcbiAgICAgICAgICB0ZW1wbGF0ZTogXCI8Z3ctbG9naW4+PC9ndy1sb2dpbj5cIlxuICAgICAgICB9KTtcbiAgICB9IF0gKTtcblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29udHJvbGxlcihcImV4ZXJjaXNlT25lQ29udHJvbGxlclwiLCBmdW5jdGlvbihlcykgeyAvL2luamVjdFxuXG4gICAgICB0aGlzLmV4ZXJjaXNlU2VydmljZSA9IGVzOyAvL2V4cG9zZVxuXG4gICAgICB0aGlzLnRpdGxlID0gXCJFeGVyY2lzZSAxLCBpbiB0aGUgY29udHJvbGxlclwiO1xuXG5cdFx0XHR0aGlzLmNsaWNrQWN0aW9uID0gKCkgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZyh0aGlzKTtcblx0XHRcdH07XG5cblx0XHRcdHRoaXMuc3R1ZGVudHMgPSBbXG5cdFx0XHRcdHsgbmFtZTogXCJKb2huXCIgfSxcblx0XHRcdFx0eyBuYW1lOiBcIkpvc2hcIiB9LFxuXHRcdFx0XHR7IG5hbWU6IFwiTWFja1wiIH1cblx0XHRcdF07XG5cbn0pXG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyXG4gICAgLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXG4gICAgLmNvbnRyb2xsZXIoXCJleGVyY2lzZVR3b0NvbnRyb2xsZXJcIiwgZnVuY3Rpb24oZXMpIHsgLy9pbmplY3RcblxuICAgICAgdGhpcy5leGVyY2lzZVNlcnZpY2UgPSBlczsgLy9leHBvc2VcblxuICAgICAgdGhpcy50aXRsZSA9IFwiRXhlcmNpc2UgMlwiO1xuXG5cbiAgICAgIGNvbnN0IG9yaWdpbmFsQnV0dG9uVGV4dCA9IFwiQnV0dG9uIFRleHRcIjtcbiAgICAgIHRoaXMuYnV0dG9uVGV4dCA9IG9yaWdpbmFsQnV0dG9uVGV4dDtcblxuICAgICAgdGhpcy5wb3NzaWJsZUNvbG9ycyA9IFtcbiAgICAgICAge25hbWUgIDogXCJCcm93blwiLFxuICAgICAgICBoZXggICA6IFwiI2E1MlwifSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWUgOiBcIkJsdWVcIixcbiAgICAgICAgICBoZXggOiBcIiMwMDAwRkZcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZSA6IFwiR2FpbnNib3JvXCIsXG4gICAgICAgICAgaGV4IDogXCIjZGNkY2RjXCJcbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgdGhpcy5fZ2V0UmFuZG9tQ29sb3IgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJhbmRvbUNvbG9yID0gdGhpcy5wb3NzaWJsZUNvbG9yc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLnBvc3NpYmxlQ29sb3JzLmxlbmd0aCldO1xuICAgICAgICByZXR1cm4gcmFuZG9tQ29sb3I7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLl9jcmVhdGVPYmplY3QgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJldHVybk9iamVjdCA9IHtcbiAgICAgICAgICBuYW1lICAgICAgIDogXCJPYmpcIiArICh0aGlzLm9iamVjdEFycmF5Lmxlbmd0aCArIDEpLFxuICAgICAgICAgIGNsaWNrQ291bnQgOiAwLFxuICAgICAgICAgIGNvbG9yIDogdGhpcy5fZ2V0UmFuZG9tQ29sb3IoKS5oZXhcbiAgICAgICAgfTtcbiAgICAgICAgY29uc29sZS5sb2cocmV0dXJuT2JqZWN0KTtcbiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdDtcbiAgICAgIH07XG5cblxuICAgICAgdGhpcy5idXR0b25Nb3VzZUVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmJ1dHRvblRleHQgPSBcIk5ldyBCdXR0b24gVGV4dFwiO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5idXR0b25SZXNldENsaWNrID0gKCkgPT4ge1xuICAgICAgICB0aGlzLmJ1dHRvblRleHQgPSBvcmlnaW5hbEJ1dHRvblRleHQ7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLm9iamVjdEFycmF5ID0gW107XG5cbiAgICAgIHRoaXMuY29udHJvbGxlckluaXRPYmplY3QgPSB0aGlzLl9jcmVhdGVPYmplY3QoKTtcblxuXG4gICAgICAvL3RoaXMuY29udHJvbGxlckluaXRPYmplY3QuY2xpY2tDb3VudCA9IDU7XG5cbiAgICAgIHRoaXMuYWRkTmV3T2JqZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMub2JqZWN0QXJyYXkucHVzaCh0aGlzLl9jcmVhdGVPYmplY3QoKSk7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmFkZENsaWNrQ291bnQgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIG9iai5jbGlja0NvdW50Kys7XG4gICAgICAgIGNvbnNvbGUubG9nKG9iai5uYW1lLCBvYmouY2xpY2tDb3VudCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY29sb3JmaWx0ZXJDaGFuZ2VkID0gKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmZpbHRlci5jb2xvcik7XG4gICAgICAgIGlmKCF0aGlzLmZpbHRlci5jb2xvcikgZGVsZXRlIHRoaXMuZmlsdGVyLmNvbG9yO1xuICAgICAgfVxuXG5cbiAgICB9KTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuc2VydmljZShcImVzXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5sb2dnZWRJblVzZXIgPSB7fTtcbiAgICAgIHRoaXMubG9naW4gPSBsb2dpbjtcbiAgICAgIHRoaXMubG9nb3V0ID0gbG9nb3V0O1xuXG5cblxuICAgICAgLy9pbXBsZW1lbnRhdGlvblxuICAgICAgZnVuY3Rpb24gcHJpbnRDb25zb2xlICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJPdXIgdmVyeSBmaXJzdCBpbmplY3RhYmxlXCIpO1xuICAgICAgfTtcblxuICAgICAgZnVuY3Rpb24gbG9naW4gKCkge1xuICAgICAgICB0aGlzLmxvZ2dlZEluVXNlciA9IHtcbiAgICAgICAgICBuYW1lIDogXCJ1c2VyTmFtZVwiLFxuICAgICAgICAgIHBob3RvOiAoJ2h0dHBzOi8vdW5zcGxhc2guY29tLz9waG90bz1laE5Hb0I2cTVwNCcpLFxuICAgICAgICAgIHVzZXJQYXNzd29yZCA6IFwicGFzc3dvcmRcIixcbiAgICAgICAgICBkYXRlIDogRGF0ZS5ub3csXG4gICAgICAgIH07XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMubG9nZ2VkSW5Vc2VyKTtcblxuICAgICAgfTtcblxuXG4gICAgICBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gICAgICAgIHRoaXMubG9nZ2VkSW5Vc2VyID0ge307XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMubG9nZ2VkSW5Vc2VyKTtcbiAgICAgIH07XG5cbiAgICB9KVxuICAgIC5mYWN0b3J5KFwiZXNcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGdldExvZ2dlZEluVXNlcixcbiAgICAgICAgICAgICAgICBsb2dpbixcbiAgICAgICAgICAgICAgICBsb2dvdXRcbiAgICAgICAgICAgIH07XG5cblxuICAgICAgICAgICAgbGV0IGxvZ2dlZEluVXNlciA9IHsgdGVzdCA6IFwidGVzdFwiIH07XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldExvZ2dlZEluVXNlcigpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkdldHRpbmcgbG9nZ2VkSW5Vc2VyXCIsIGxvZ2dlZEluVXNlcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvZ2dlZEluVXNlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gbG9naW4oKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJXZSdyZSBoZXJlIGZhY3Rvcnkgc3R5bGVcIik7XG4gICAgICAgICAgICAgICAgZGVidWdnZXI7XG5cbiAgICAgICAgICAgICAgICBsb2dnZWRJblVzZXIgPSB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUgICAgICA6IFwiVGVkXCIsXG4gICAgICAgICAgICAgICAgICAgIHBob3RvICAgICA6IFwiYW5ndWxhcmljb24uanBnXCIsXG4gICAgICAgICAgICAgICAgICAgIGxvZ2luVGltZSA6IERhdGUubm93KClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgICAgICAgICAgICAgICBsb2dnZWRJblVzZXIgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuZmFjdG9yeShcImxvZ2luU2VydmljZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGxldCBsb2dnZWRJblVzZXIgPSBudWxsO1xuICAgICAgbGV0IG5vdGlmeUNvbnRyb2xsZXJDYWxsYmFjayA9IG51bGw7XG5cbiAgICAgIC8vYWN0aXZlbHkgbGlzdGVucyBGaXJlYmFzZSBhdXRoZW50aWNhdGlvbiBhbmQgZmlyZXMgY2FsbGJhY2tcbiAgICAgIGZpcmViYXNlLmF1dGgoKS5vbkF1dGhTdGF0ZUNoYW5nZWQodXBkYXRlTG9naW5TdGF0dXMpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXRMb2dnZWRJblVzZXIsXG4gICAgICAgIGxvZ2luLFxuICAgICAgICBsb2dvdXRcbiAgICAgIH07XG5cbiAgICAgIGZ1bmN0aW9uIGdldExvZ2dlZEluVXNlcigpIHtcbiAgICAgICAgcmV0dXJuIGxvZ2dlZEluVXNlcjtcbiAgICAgIH07XG5cbiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUxvZ2luU3RhdHVzKGF1dGhlbnRpY2F0ZWRVc2VyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGF1dGhlbnRpY2F0ZWRVc2VyKTtcblxuICAgICAgICBsb2dnZWRJblVzZXIgPSBhdXRoZW50aWNhdGVkVXNlcjtcblxuICAgICAgICBpZiAobm90aWZ5Q29udHJvbGxlckNhbGxiYWNrKSBub3RpZnlDb250cm9sbGVyQ2FsbGJhY2soKTtcblxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBsb2dpbihjYWxsYmFjaykge1xuICAgICAgICBub3RpZnlDb250cm9sbGVyQ2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgICAgcmV0dXJuIGZpcmViYXNlLmF1dGgoKS5zaWduSW5XaXRoUG9wdXAobmV3IGZpcmViYXNlLmF1dGguR2l0aHViQXV0aFByb3ZpZGVyKCkpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gICAgICAgIGxvZ2dlZEluVXNlciA9IG51bGw7XG4gICAgICAgIHJldHVybiBmaXJlYmFzZS5hdXRoKCkuc2lnbk91dCgpO1xuICAgICAgfVxuICAgIH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuXG4gICAgICAgIC5mYWN0b3J5KFwibmF2aWdhdGlvblNlcnZpY2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBnZXROYXZpZ2F0aW9uLFxuICAgICAgICAgICAgICAgIGFkZE5hdmlnYXRpb25JdGVtLFxuICAgICAgICAgICAgICAgIHJlbW92ZU5hdmlnYXRpb25JdGVtXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgbmF2aWdhdGlvbkl0ZW1zID0gW107XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldE5hdmlnYXRpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRpb25JdGVtcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gYWRkTmF2aWdhdGlvbkl0ZW0oaXRlbSkge1xuICAgICAgICAgICAgICAgIGlmICghbmF2aWdhdGlvbkl0ZW1zKSBuYXZpZ2F0aW9uSXRlbXMgPSBbXTtcbiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uSXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gcmVtb3ZlTmF2aWdhdGlvbkl0ZW0oaXRlbSkge1xuICAgICAgICAgICAgICAgIG5hdmlnYXRpb25JdGVtcy5mb3JFYWNoKChpdGVtSW5OYXZpZ2F0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbUluTmF2aWdhdGlvbi5pZCA9PT0gaXRlbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbkl0ZW1zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24oYW5ndWxhcikge1xuXHRhbmd1bGFyXG5cdFx0Lm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXG5cblx0XHQuZmFjdG9yeShcInJvb21TZXJ2aWNlXCIsIGZ1bmN0aW9uKCR0aW1lb3V0KSB7XG5cdFx0XHRsZXQgcm9vbXMgPSBudWxsO1xuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRnZXRSb29tcyxcblx0XHRcdFx0Z2V0Um9vbUJ5SWQsXG5cdFx0XHRcdGZldGNoUm9vbXNGcm9tREJcblx0XHRcdH07XG5cblx0XHRcdGZ1bmN0aW9uIGdldFJvb21zKCkge1xuXHRcdFx0XHRyZXR1cm4gcm9vbXM7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGdldFJvb21CeUlkKGlkKSB7XG5cdFx0XHRcdHJldHVybiAkdGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRsZXQgcm9vbVRvUmV0dXJuID0gbnVsbDtcblxuXHRcdFx0XHRcdHJvb21zLmZvckVhY2goZnVuY3Rpb24ocm9vbSkge1xuXHRcdFx0XHRcdFx0aWYgKGlkID09IHJvb20uaWQpIHJvb21Ub1JldHVybiA9IHJvb207XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRyZXR1cm4gcm9vbVRvUmV0dXJuO1xuXHRcdFx0XHR9LCAxNTAwKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZmV0Y2hSb29tc0Zyb21EQigpIHtcblx0XHRcdFx0cmV0dXJuICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHJvb21zID0gW1xuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRuYW1lICAgIDogXCJIYWxvXCIsXG5cdFx0XHRcdFx0XHRcdGlkICAgICAgOiAxLFxuXHRcdFx0XHRcdFx0XHRwaWN0dXJlIDogJ3d3dy9hc3NldHMvaW1hZ2VzL2hhbG8uanBnJ1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0bmFtZSAgICA6IFwiU29uaWNcIixcblx0XHRcdFx0XHRcdFx0aWQgICAgICA6IDIsXG5cdFx0XHRcdFx0XHRcdHBpY3R1cmUgOiAnd3d3L2Fzc2V0cy9pbWFnZXMvc29uaWMuanBnJ1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0bmFtZSAgICA6IFwiWmVsZGFcIixcblx0XHRcdFx0XHRcdFx0aWQgICAgICA6IDMsXG5cdFx0XHRcdFx0XHRcdHBpY3R1cmUgOiAnd3d3L2Fzc2V0cy9pbWFnZXMvemVsZGEuanBnJ1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0bmFtZSAgICA6IFwiU3RhciBGb3hcIixcblx0XHRcdFx0XHRcdFx0aWQgICAgICA6IDQsXG5cdFx0XHRcdFx0XHRcdHBpY3R1cmUgOiAnd3d3L2Fzc2V0cy9pbWFnZXMvc3RhcmZveC5qcGcnXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdF07XG5cblx0XHRcdFx0XHRyZXR1cm4gcm9vbXM7XG5cdFx0XHRcdH0sIDE1MDApO1xuXHRcdFx0fVxuXHRcdH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29tcG9uZW50KFwiZ3dMb2dpblwiLCB7XG4gICAgICB0ZW1wbGF0ZVVybCA6IFwid3d3L2FwcC9jb21wb25lbnRzL2xvZ2luL2xvZ2luLmh0bVwiLFxuICAgICAgY29udHJvbGxlciAgOiBcImxvZ2luQ29tcG9uZW50Q29udHJvbGxlclwiLFxuICAgICAgY29udHJvbGxlckFzOiBcImN0cmxcIlxuICAgIH0pO1xufSAod2luZG93LmFuZ3VsYXIpKTtcbiIsIiggZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuICAgIC5jb250cm9sbGVyKFwibG9naW5Db21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uKCRzY29wZSwgbG9naW5TZXJ2aWNlKXtcbiAgICAgIHRoaXMubG9naW5TZXJ2aWNlID0gbG9naW5TZXJ2aWNlO1xuXG4gICAgICB0aGlzLmdldExvZ2dlZEluVXNlciA9IGxvZ2luU2VydmljZS5nZXRMb2dnZWRJblVzZXI7XG5cbiAgICAgIHRoaXMucmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNvbnRyb2xsZXIgcmVmcmVzaCBjYWxsZWRcIik7XG4gICAgICAgICRzY29wZS4kYXBwbHkoKTtcbiAgICAgIH1cblxuICAgIH0pO1xufSAod2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyXG4gICAgLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXG4gICAgLmNvbXBvbmVudChcImd3TmF2aWdhdGlvblwiLCB7XG4gICAgICB0ZW1wbGF0ZVVybCA6IFwid3d3L2FwcC9jb21wb25lbnRzL25hdmlnYXRpb24vbmF2aWdhdGlvbi5odG1cIixcbiAgICAgIGNvbnRyb2xsZXIgIDogXCJuYXZpZ2F0aW9uQ29tcG9uZW50Q29udHJvbGxlclwiLFxuICAgICAgY29udHJvbGxlckFzOiBcImN0cmxcIlxuICAgIH0pO1xufSAod2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29udHJvbGxlcihcIm5hdmlnYXRpb25Db21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uKCRsb2NhdGlvbiwgbmF2aWdhdGlvblNlcnZpY2UsIHJvb21TZXJ2aWNlKSB7XG4gICAgICB0aGlzLiRvbkluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uU2VydmljZSA9IG5hdmlnYXRpb25TZXJ2aWNlO1xuICAgICAgICB0aGlzLnJvb21TZXJ2aWNlID0gcm9vbVNlcnZpY2U7XG4gICAgICAgIHJvb21TZXJ2aWNlLmZldGNoUm9vbXNGcm9tREIoKTtcblxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIk5hdmlnYXRpb25Jbml0XCIpO1xuXG4gICAgICAgIC8vIGxldCB3ZWxjb21lSXRlbSA9IHtcbiAgICAgICAgLy8gICB0aXRsZTogXCJXZWxjb21lXCIsXG4gICAgICAgIC8vICAgdXJsOiBcIi93ZWxjb21lXCJcbiAgICAgICAgLy8gfTtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gbmF2aWdhdGlvblNlcnZpY2UuYWRkTmF2aWdhdGlvbkl0ZW0od2VsY29tZUl0ZW0pO1xuXG4gICAgICAgIC8vIGFkZCByb29tc1xuICAgICAgICAvLyBsZXQgcm9vbXMgPSByb29tU2VydmljZS5mZXRjaFJvb21zRnJvbURCKCk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHJvb21zKTtcbiAgICAgICAgLy8gcm9vbXMuZm9yRWFjaChmdW5jdGlvbihyb29tKSB7XG4gICAgICAgIC8vICAgY29uc29sZS5sb2cocm9vbSk7XG4gICAgICAgIC8vICAgY29uc3QgaXRlbVRvQWRkID0ge1xuICAgICAgICAvLyAgICAgdGl0bGU6IHJvb20ubmFtZSxcbiAgICAgICAgLy8gICAgIHVybDogXCIvcm9vbS8kKHJvb20uaWQpXCJcbiAgICAgICAgLy8gICB9O1xuICAgICAgICAvLyAgIG5hdmlnYXRpb25TZXJ2aWNlLmFkZE5hdmlnYXRpb25JdGVtKGl0ZW1Ub0FkZCk7XG4gICAgICAgIC8vIH0pO1xuXG4gICAgICAgIC8vIGFkZCBhYm91dCBsaW5rXG4gICAgICAvLyAgIGxldCBhYm91dEl0ZW0gPSB7XG4gICAgICAvLyAgICAgdGl0bGU6IFwiQWJvdXRcIixcbiAgICAgIC8vICAgICB1cmw6IFwiL2Fib3V0XCJcbiAgICAgIC8vICAgfTtcbiAgICAgIC8vXG4gICAgICAvLyAgIG5hdmlnYXRpb25TZXJ2aWNlLmFkZE5hdmlnYXRpb25JdGVtKGFib3V0SXRlbSk7XG4gICAgICAvL1xuICAgICAgfTtcblxuICAgICAgdGhpcy5pc0l0ZW1BY3RpdmUgPSBmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgcmV0dXJuIHVybCA9PT0gJGxvY2F0aW9uLnBhdGgoKTtcbiAgICAgIH07XG5cblxuXG4gICAgfSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuICAgIC5jb21wb25lbnQoXCJnd1Jvb21cIiwge1xuICAgICAgdGVtcGxhdGVVcmwgICA6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb20vcm9vbS5odG1cIixcbiAgICAgIGNvbnRyb2xsZXIgICAgOiBcInJvb21Db21wb25lbnRDb250cm9sbGVyXCIsXG4gICAgICBjb250cm9sbGVyQXMgIDogXCJjdHJsXCJcblxuICAgIH0pO1xufSAod2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbiAoYW5ndWxhcikge1xuXHRhbmd1bGFyXG5cdFx0Lm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXG5cblx0XHQuY29udHJvbGxlcihcInJvb21Db21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uIChyb29tU2VydmljZSwgJHJvdXRlUGFyYW1zKSB7XG5cdFx0XHR0aGlzLiRvbkluaXQgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0Y29uc29sZS5sb2codGhpcyk7XG5cblx0XHRcdFx0dGhpcy5sb2FkaW5nID0gdHJ1ZTtcblxuXHRcdFx0XHR0aGlzLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG5cdFx0XHRcdHRoaXMuc3RhcnRUaW1lLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuXG5cdFx0XHRcdHRoaXMuZW5kVGltZSA9IG5ldyBEYXRlKCk7XG5cdFx0XHRcdHRoaXMuZW5kVGltZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcblxuXHRcdFx0XHR0aGlzLnJlc2VydmVSZWFzb25zID0gW1xuXHRcdFx0XHRcdFwiQmlydGhkYXlcIixcblx0XHRcdFx0XHRcIkNvbmZlcmVuY2VcIixcblx0XHRcdFx0XHRcIkludGVydmlld1wiLFxuXHRcdFx0XHRcdFwiU2NydW0gTWVldGluZ1wiLFxuXHRcdFx0XHRcdFwiSG9uZXltb29uXCJcblx0XHRcdFx0XTtcblxuXHRcdFx0XHRyb29tU2VydmljZS5nZXRSb29tQnlJZCgkcm91dGVQYXJhbXMuaWQpLnRoZW4ocm9vbVJlc3VsdCA9PiB7XG5cdFx0XHRcdFx0dGhpcy5yb29tID0gcm9vbVJlc3VsdDtcblx0XHRcdFx0XHR0aGlzLmxvYWRpbmcgPSBmYWxzZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMucm9vbVN1Ym1pc3Npb24gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHRoaXMuZ2V0TWluVGltZSgpID49IHRoaXMuZW5kVGltZSkge1xuXHRcdFx0XHRcdHRoaXMubXlGb3JtLmVuZFRpbWUuJHNldFZhbGlkaXR5KFwibWluXCIsIGZhbHNlKVxuXG5cdFx0XHRcdFx0cmV0dXJuIGFsZXJ0KFwiTWVzc2FnZSBmcm9tIGNvbnRyb2xsZXI6IHRpbWUgaW52YWxpZFwiKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0aGlzLm15Rm9ybS4kaW52YWxpZCkgcmV0dXJuIGFsZXJ0KFwiTWVzc2FnZSBmcm9tIGNvbnRyb2xsZXI6IGZvcm0gaW52YWxpZFwiKTtcblxuXHRcdFx0XHRhbGVydChcIlJvb20gc3VibWl0dGVkXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmdldE1pblRpbWUgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0bGV0IGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnN0YXJ0VGltZSk7XG5cdFx0XHRcdGRhdGUuc2V0SG91cnMoZGF0ZS5nZXRIb3VycygpICsgMSk7XG5cblx0XHRcdFx0cmV0dXJuIGRhdGU7XG5cdFx0XHR9O1xuXHRcdH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29tcG9uZW50KFwiZ3dSb29tUmVzZXJ2YXRpb25Gb3JtXCIsIHtcbiAgICAgIHRlbXBsYXRlVXJsICAgOiBcInd3dy9hcHAvY29tcG9uZW50cy9yb29tL3Jvb20tcmVzZXJ2YXRpb24tZm9ybS9yb29tLXJlc2VydmF0aW9uLWZvcm0uaHRtXCIsXG4gICAgICBjb250cm9sbGVyICAgIDogXCJyb29tUmVzZXJ2YXRpb25Gb3JtQ29tcG9uZW50Q29udHJvbGxlclwiLFxuICAgICAgY29udHJvbGxlckFzICA6IFwiY3RybFwiLFxuICAgICAgYmluZGluZ3MgICAgICA6IHtcbiAgICAgICAgcm9vbSA6IFwiPFwiXG4gICAgICB9XG5cbiAgICB9KTtcbn0gKHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwicm9vbVJlc2VydmF0aW9uRm9ybUNvbXBvbmVudENvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHRoaXMuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgdGhpcy5zdGFydFRpbWUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG5cbiAgICAgICAgICB0aGlzLmVuZFRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgIHRoaXMuZW5kVGltZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcblxuICAgICAgICAgIHRoaXMucmVzZXJ2ZVJlYXNvbnMgPSBbXG4gICAgICAgICAgICAgIFwiQmlydGhkYXlcIixcbiAgICAgICAgICAgICAgXCJDb25mZXJlbmNlXCIsXG4gICAgICAgICAgICAgIFwiSW50ZXJ2aWV3XCIsXG4gICAgICAgICAgICAgIFwiU2NydW0gTWVldGluZ1wiLFxuICAgICAgICAgICAgICBcIkhvbmV5bW9vblwiXG4gICAgICAgICAgXTtcblxuICAgICAgICAgIHJvb21TZXJ2aWNlLmdldFJvb21CeUlkKCRyb3V0ZVBhcmFtcy5pZCkudGhlbihyb29tUmVzdWx0ID0+IHtcbiAgICAgICAgICAgIHRoaXMucm9vbSA9IHJvb21SZXN1bHQ7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5yb29tU3VibWlzc2lvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZighdGhpcy5yb29tLnJlc2VydmF0aW9ucykge1xuICAgICAgICAgICAgICB0aGlzLnJvb20ucmVzZXJ2YXRpb25zID0gW107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVzZXJ2aW5nIGZvclwiLCB0aGlzLnJvb20pO1xuICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5teUZvcm0pO1xuXG4gICAgXHRcdFx0XHRpZiAodGhpcy5nZXRNaW5UaW1lKCkgPj0gdGhpcy5lbmRUaW1lKSB7XG4gICAgXHRcdFx0XHRcdHRoaXMubXlGb3JtLmVuZFRpbWUuJHNldFZhbGlkaXR5KFwibWluXCIsIGZhbHNlKVxuXG4gICAgXHRcdFx0XHRcdHJldHVybiBhbGVydChcIk1lc3NhZ2UgZnJvbSBjb250cm9sbGVyOiB0aW1lIGludmFsaWRcIik7XG4gICAgXHRcdFx0XHR9XG5cbiAgICBcdFx0XHRcdGlmICh0aGlzLm15Rm9ybS4kaW52YWxpZCkgcmV0dXJuIGFsZXJ0KFwiTWVzc2FnZSBmcm9tIGNvbnRyb2xsZXI6IGZvcm0gaW52YWxpZFwiKTtcblxuICAgIFx0XHRcdFx0YWxlcnQoXCJSb29tIHN1Ym1pdHRlZFwiKTtcbiAgICBcdFx0XHR9XG5cbiAgICBcdFx0XHR0aGlzLmdldE1pblRpbWUgPSBmdW5jdGlvbigpIHtcbiAgICBcdFx0XHRcdGxldCBkYXRlID0gbmV3IERhdGUodGhpcy5zdGFydFRpbWUpO1xuICAgIFx0XHRcdFx0ZGF0ZS5zZXRIb3VycyhkYXRlLmdldEhvdXJzKCkgKyAxKTtcblxuICAgIFx0XHRcdFx0cmV0dXJuIGRhdGU7XG4gICAgXHRcdFx0fTtcblxuXG4gICAgICAgIH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29tcG9uZW50KFwiZ3dSb29tUmVzZXJ2YXRpb25MaXN0XCIsIHtcbiAgICAgIHRlbXBsYXRlVXJsICAgOiBcInd3dy9hcHAvY29tcG9uZW50cy9yb29tL3Jvb20tcmVzZXJ2YXRpb24tbGlzdC9yb29tLXJlc2VydmF0aW9uLWxpc3QuaHRtXCIsXG4gICAgICBjb250cm9sbGVyICAgIDogXCJyb29tUmVzZXJ2YXRpb25MaXN0Q29tcG9uZW50Q29udHJvbGxlclwiLFxuICAgICAgY29udHJvbGxlckFzICA6IFwiY3RybFwiLFxuICAgICAgcmVxdWlyZSAgICAgICA6IHtcbiAgICAgICAgcGFyZW50Q29udHJvbGxlciA6IFwiXmd3Um9vbVwiXG4gICAgICB9XG5cbiAgICB9KTtcbn0gKHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwicm9vbVJlc2VydmF0aW9uTGlzdENvbXBvbmVudENvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcbiAgICAuY29tcG9uZW50KFwiZ3dSb29tU3RhdHVzSGVhZGVyXCIsIHtcbiAgICAgIHRlbXBsYXRlVXJsICAgOiBcInd3dy9hcHAvY29tcG9uZW50cy9yb29tL3Jvb20tc3RhdHVzLWhlYWRlci9yb29tLXN0YXR1cy1oZWFkZXIuaHRtXCIsXG4gICAgICBjb250cm9sbGVyICAgIDogXCJyb29tU3RhdHVzSGVhZGVyQ29tcG9uZW50Q29udHJvbGxlclwiLFxuICAgICAgY29udHJvbGxlckFzICA6IFwiY3RybFwiLFxuICAgICAgYmluZGluZ3MgICAgICAgOiB7XG4gICAgICAgIHJvb20gOiBcIkBcIlxuICAgICAgfVxuXG4gICAgfSk7XG59ICh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcblxuICAgICAgICAuY29udHJvbGxlcihcInJvb21TdGF0dXNIZWFkZXJDb21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICB9KTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiJdfQ==
